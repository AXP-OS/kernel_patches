From 8de3fe39e7c40190f82832253ed5946714e5bff1 Mon Sep 17 00:00:00 2001
From: Terence Ho <terenceh@codeaurora.org>
Date: Tue, 30 Jun 2015 10:24:01 -0400
Subject: [PATCH] msm: camera: Set cropinfo pointer to NULL after free

Set crop info pointer to NULL to prevent use after
it has been freed.

Change-Id: Icc4fd7b41b131c91fb68cae45c8698dc0a1a6eeb
Signed-off-by: Terence Ho <terenceh@codeaurora.org>
---
 drivers/media/video/msm/msm_camera.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/media/video/msm/msm_camera.c b/drivers/media/video/msm/msm_camera.c
index 3aff1d9..37aa7d8 100644
--- a/drivers/media/video/msm/msm_camera.c
+++ b/drivers/media/video/msm/msm_camera.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2009-2012, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2009-2012, 2015 The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -2485,6 +2485,7 @@ static int msm_set_crop(struct msm_sync *sync, void __user *arg)
 		ERR_COPY_FROM_USER();
 		sync->croplen = 0;
 		kfree(sync->cropinfo);
+		sync->cropinfo = NULL;
 		mutex_unlock(&sync->lock);
 		return -EFAULT;
 	}
-- 
1.8.2.1

