From 1879b791a581f92770dbd0bb4c7633a3e6fcf482 Mon Sep 17 00:00:00 2001
From: Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
Date: Thu, 15 Dec 2016 08:13:20 -0700
Subject: [PATCH] net: ipc_router: Register services only on client port

Allowing services to be registered on a non-client port will cause either
an existing service or a control port to be over-written. This will cause
undefined functional behavior.

Allow the services to be registered only on client ports.

CRs-Fixed: 1101792
CAF-Change-Id: If6cfc75e9314204b7b44957f1598a8a2e1a45325
Signed-off-by: Karthikeyan Ramasubramanian <kramasub@codeaurora.org>
CVE-2017-0463
[haggertk]: Backport to 3.4/msm8974

Change-Id: I0bf408cbb8c5bb0183740530ef1c255c57e8ec54
Signed-off-by: Kevin F. Haggerty <haggertk@lineageos.org>
---
 arch/arm/mach-msm/ipc_router.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/arch/arm/mach-msm/ipc_router.c b/arch/arm/mach-msm/ipc_router.c
index 74ce06c862e..41a4214c85b 100644
--- a/arch/arm/mach-msm/ipc_router.c
+++ b/arch/arm/mach-msm/ipc_router.c
@@ -2176,6 +2176,9 @@ int msm_ipc_router_register_server(struct msm_ipc_port *port_ptr,
 	if (port_ptr->type != CLIENT_PORT)
 		return -EINVAL;
 
+	if (port_ptr->type != CLIENT_PORT)
+		return -EINVAL;
+
 	if (name->addrtype != MSM_IPC_ADDR_NAME)
 		return -EINVAL;
 
