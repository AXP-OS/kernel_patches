From 99bcd83281832d0a61af69bc2ded1c4e5e7b8a4f Mon Sep 17 00:00:00 2001
From: Nick Desaulniers <ndesaulniers@google.com>
Date: Thu, 4 May 2017 13:25:44 -0700
Subject: [PATCH] Revert "proc: smaps: Allow smaps access for CAP_SYS_RESOURCE"

This reverts commit f0ce0eee6b71bc310153edb87e66e6b25e12fece.

Bug: 34951864
Bug: 36468447
Change-Id: I87bd92e096c6c28a53b9ecf302ae008f5e58eba1
Signed-off-by: Nick Desaulniers <ndesaulniers@google.com>
CVE-2017-0710
Signed-off-by: Kevin F. Haggerty <haggertk@lineageos.org>
---
 kernel/fork.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/kernel/fork.c b/kernel/fork.c
index c5701ed2360..9c5cc0339e6 100644
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@ -708,8 +708,7 @@ struct mm_struct *mm_access(struct task_struct *task, unsigned int mode)
 
 	mm = get_task_mm(task);
 	if (mm && mm != current->mm &&
-			!ptrace_may_access(task, mode) &&
-			!capable(CAP_SYS_RESOURCE)) {
+			!ptrace_may_access(task, mode)) {
 		mmput(mm);
 		mm = ERR_PTR(-EACCES);
 	}
