From 0087818a2518e7c7f35375262a7bba6cebf38f06 Mon Sep 17 00:00:00 2001
From: Krunal Soni <ksoni@codeaurora.org>
Date: Tue, 24 Oct 2017 23:33:05 -0700
Subject: qcacmn: Fix to propagate key-receiver-sequence-counter to WMI

SME module propagates KeyRSC to MAC/PE module but MAC/PE doesn't
pass this counter to WMA and due to which WMA is not able pass to
WMI module.

Add a fix to propagate KeyRSC field from MAC to WMA module and
WMA to WMI module.

CRs-Fixed: 2130765
Change-Id: I0de6907bf8aa159eccb1d8310e7027f8fdf19fff
---
 wmi/src/wmi_unified_tlv.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/wmi/src/wmi_unified_tlv.c b/wmi/src/wmi_unified_tlv.c
index e59ea9c..74065f2 100644
--- a/wmi/src/wmi_unified_tlv.c
+++ b/wmi/src/wmi_unified_tlv.c
@@ -4940,6 +4940,9 @@ static QDF_STATUS send_setup_install_key_cmd_tlv(wmi_unified_t wmi_handle,
 	key_data = (A_UINT8 *) (buf_ptr + WMI_TLV_HDR_SIZE);
 	qdf_mem_copy((void *)key_data,
 		     (const void *)key_params->key_data, key_params->key_len);
+	if (key_params->key_rsc_counter)
+	    qdf_mem_copy(&cmd->key_rsc_counter, key_params->key_rsc_counter,
+			 sizeof(wmi_key_seq_counter));
 	cmd->key_len = key_params->key_len;
 
 	status = wmi_unified_cmd_send(wmi_handle, buf, len,
-- 
cgit v1.1

