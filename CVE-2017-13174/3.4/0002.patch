From d3750af6a8cfa7a3f24208367d4ac1aee14f8501 Mon Sep 17 00:00:00 2001
From: Wei Li <sirius.liwei@huawei.com>
Date: Thu, 31 Aug 2017 14:20:08 -0400
Subject: [PATCH] msm8974: remove 'reboot edl' interface for security.

BUG: 63100473

Change-Id: If6cb5ce50524d34b30f09a22eeb76d2cd3a0e834
CVE-2017-13174
Signed-off-by: Kevin F. Haggerty <haggertk@lineageos.org>
---
 arch/arm/mach-msm/restart.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/arch/arm/mach-msm/restart.c b/arch/arm/mach-msm/restart.c
index 5fcd7276fcb..0f37db31f8e 100644
--- a/arch/arm/mach-msm/restart.c
+++ b/arch/arm/mach-msm/restart.c
@@ -124,6 +124,7 @@ static bool get_dload_mode(void)
 }
 #endif
 
+#if 0
 static void enable_emergency_dload_mode(void)
 {
 	if (emergency_dload_mode_addr) {
@@ -142,6 +143,7 @@ static void enable_emergency_dload_mode(void)
 		mb();
 	}
 }
+#endif
 
 static int dload_set(const char *val, struct kernel_param *kp)
 {
@@ -170,10 +172,12 @@ void set_dload_mode(int on)
 }
 EXPORT_SYMBOL(set_dload_mode);
 
+#if 0
 static void enable_emergency_dload_mode(void)
 {
 	printk(KERN_ERR "dload mode is not enabled on target\n");
 }
+#endif
 
 static bool get_dload_mode(void)
 {
@@ -382,9 +386,11 @@ static void msm_restart_prepare(const char *cmd)
 		} else if (!strncmp(cmd, "nvrecovery", 10)) {
 			__raw_writel(0x77665515, restart_reason);
 			warm_reboot_set = 1;
+#if 0
 		} else if (!strncmp(cmd, "edl", 3)) {
 			enable_emergency_dload_mode();
 			warm_reboot_set = 1;
+#endif
 		} else if (strlen(cmd) == 0) {
 			printk(KERN_NOTICE "%s : value of cmd is NULL.\n", __func__);
 			__raw_writel(0x12345678, restart_reason);
