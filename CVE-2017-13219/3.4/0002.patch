From af19568286ff5a2d36e408dbc56dae158f3ada2b Mon Sep 17 00:00:00 2001
From: Steve Pfetsch <spfetsch@google.com>
Date: Fri, 3 Nov 2017 16:21:07 -0700
Subject: [PATCH] input: synaptics: restrict sysfs node write permissions

Bug: 62800865
Change-Id: I4db40f172841306da4c14ffb649e59b3192e3fc7
Signed-off-by: Steve Pfetsch <spfetsch@google.com>
CVE-2017-13219
[haggertk: Port from synaptics_dsx_htc_2.6 to synaptics driver
 and correct all other S_IWGRP instances; original change only
 needed to impact pid]
Signed-off-by: Kevin F. Haggerty <haggertk@lineageos.org>
(cherry picked from commit ff3a97a2798ae195f2cad878f2ab364bf50caaf9)
---
 drivers/input/touchscreen/synaptics/rmi_db.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/drivers/input/touchscreen/synaptics/rmi_db.c b/drivers/input/touchscreen/synaptics/rmi_db.c
index 54983d21b75f..173610dad3c9 100644
--- a/drivers/input/touchscreen/synaptics/rmi_db.c
+++ b/drivers/input/touchscreen/synaptics/rmi_db.c
@@ -90,7 +90,7 @@ struct rmidb_handle {
 static struct bin_attribute attr_data = {
 	.attr = {
 		.name = "data",
-		.mode = (S_IRUGO | S_IWUSR | S_IWGRP),
+		.mode = (S_IRUGO | S_IWUSR),
 	},
 	.size = 0,
 	.read = rmidb_sysfs_data_show,
@@ -98,16 +98,16 @@ static struct bin_attribute attr_data = {
 };
 
 static struct device_attribute attrs[] = {
-	__ATTR(pid, S_IRUGO | S_IWUSR | S_IWGRP,
+	__ATTR(pid, S_IRUGO | S_IWUSR,
 			rmidb_sysfs_pid_show,
 			rmidb_sysfs_pid_store),
-	__ATTR(term, S_IWUSR | S_IWGRP,
+	__ATTR(term, S_IWUSR,
 			synaptics_rmi4_show_error,
 			rmidb_sysfs_term_store),
-	__ATTR(address, S_IRUGO | S_IWUSR | S_IWGRP,
+	__ATTR(address, S_IRUGO | S_IWUSR,
 			rmidb_sysfs_address_show,
 			rmidb_sysfs_address_store),
-	__ATTR(length, S_IRUGO | S_IWUSR | S_IWGRP,
+	__ATTR(length, S_IRUGO | S_IWUSR,
 			rmidb_sysfs_length_show,
 			rmidb_sysfs_length_store),
 	__ATTR(query_base_addr, S_IRUGO,
