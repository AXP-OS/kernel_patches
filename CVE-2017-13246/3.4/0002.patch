From 1e1de788c4a1b54d24b834bc3e9ba1b1b5541d6d Mon Sep 17 00:00:00 2001
From: Paul Lawrence <paullawrence@google.com>
Date: Wed, 18 Oct 2017 09:20:15 -0700
Subject: [PATCH] iovec: make sure the caller actually wants anything in
 memcpy_fromiovecend

Based on upstream change 06ebb06d49486676272a3c030bfeef4bd969a8e6

One more instance when the caller requests 0 bytes instead of running
off and dereferencing potentially invalid iovecs.

Signed-off-by: Paul Lawrence <paullawrence@google.com>
Bug: 36279469
Change-Id: Ib8d529e17c07c77357ab70bd6a2d7e305d6b27f0
CVE-2017-13246
Signed-off-by: Kevin F. Haggerty <haggertk@lineageos.org>
(cherry picked from commit b8bc983f0fd0b5b1ef73d2b3818a91b2b1d24a79)
---
 net/core/iovec.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/net/core/iovec.c b/net/core/iovec.c
index d1628b79286..c6de6dd3e5b 100644
--- a/net/core/iovec.c
+++ b/net/core/iovec.c
@@ -197,6 +197,10 @@ int csum_partial_copy_fromiovecend(unsigned char *kdata, struct iovec *iov,
 	__wsum csum = *csump;
 	int partial_cnt = 0, err = 0;
 
+	/* No data? Done! */
+	if (len == 0)
+		return 0;
+
 	/* Skip over the finished iovecs */
 	while (offset >= iov->iov_len) {
 		offset -= iov->iov_len;
