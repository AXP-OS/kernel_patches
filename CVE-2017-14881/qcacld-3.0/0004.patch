From 32edc547254f773ad8badaf0ac5279a201c8388e Mon Sep 17 00:00:00 2001
From: yeshwanth sriram guntuka <ysriramg@codeaurora.org>
Date: Wed, 26 Jul 2017 11:09:20 +0530
Subject: qcacld-3.0: Fix kernel memory corruption

Buffer overflow in ConvertQosMapsetFrame function
when num_dscp_exceptions value is less than 16.

Fix is to return from function if num_dscp_exceptions
is less than 16.

Change-Id: I2fcce60b7fe5e988348cee786e9a4d493d9512fe
CRs-Fixed: 2086305
---
 core/mac/src/sys/legacy/src/utils/src/utils_parser.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/core/mac/src/sys/legacy/src/utils/src/utils_parser.c b/core/mac/src/sys/legacy/src/utils/src/utils_parser.c
index d8c4c5a..c6e8897 100644
--- a/core/mac/src/sys/legacy/src/utils/src/utils_parser.c
+++ b/core/mac/src/sys/legacy/src/utils/src/utils_parser.c
@@ -714,6 +714,8 @@ void convert_qos_mapset_frame(tpAniSirGlobal pMac, tSirQosMapSet *Qos,
 	dot11_dscp_sz = sizeof(dot11fIE->dscp_exceptions);
 	if (dot11fIE->num_dscp_exceptions > QOS_MAP_LEN_MAX)
 		dot11fIE->num_dscp_exceptions = QOS_MAP_LEN_MAX;
+	if (dot11fIE->num_dscp_exceptions < QOS_MAP_LEN_MIN)
+		return;
 	Qos->num_dscp_exceptions =
 		(dot11fIE->num_dscp_exceptions - QOS_MAP_LEN_MIN) / 2;
 
-- 
cgit v1.1

