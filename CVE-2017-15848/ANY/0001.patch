From d24a74a7103cb6b773e1d8136ba51b64fa96b21d Mon Sep 17 00:00:00 2001
From: tharun kumar <mtharu@codeaurora.org>
Date: Mon, 14 Aug 2017 10:35:28 +0530
Subject: msm: ADSPRPC: validate user buffers after copying from user

validate user buffers before accessing in kernel driver.

Change-Id: I7997d069d0549de03f1467c63bdb81b20fcf3d6c
Acked-by: Chenna Kesava Raju <chennak@qti.qualcomm.com>
Signed-off-by: Tharun Kumar Merugu <mtharu@codeaurora.org>
---
 drivers/char/adsprpc.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index e601b99..d261f03 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -2634,6 +2634,10 @@ static long fastrpc_device_ioctl(struct file *file, unsigned int ioctl_num,
 		VERIFY(err, 0 == copy_from_user(&p.init, param, size));
 		if (err)
 			goto bail;
+		VERIFY(err, p.init.init.filelen >= 0 &&
+			p.init.init.memlen >= 0);
+		if (err)
+			goto bail;
 		VERIFY(err, 0 == fastrpc_init_process(fl, &p.init));
 		if (err)
 			goto bail;
-- 
cgit v1.1

