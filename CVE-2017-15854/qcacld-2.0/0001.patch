From aef5f626a7454844cc695a827cb87f89b37501e7 Mon Sep 17 00:00:00 2001
From: gaurank kathpalia <gkathpal@codeaurora.org>
Date: Mon, 23 Oct 2017 18:03:08 +0530
Subject: qcacld-2.0: Fix Int overflow in wma_radio_chan_stats_event_handler

Currently, value of fix_param->num_chans is received from FW
If the value of variable fix_param->num_chans  is very large,
then the derived length of data in the event can be
overflowed.

Add sanity check for fix_param->num_chans to avoid overflow

Change-Id: Iac59550b9ecdd6833d0ad262b51e56b6532941c5
CRs-Fixed: 2114396
---
 CORE/SERVICES/WMA/wma_ocb.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/CORE/SERVICES/WMA/wma_ocb.c b/CORE/SERVICES/WMA/wma_ocb.c
index ef62c6b..e753905 100644
--- a/CORE/SERVICES/WMA/wma_ocb.c
+++ b/CORE/SERVICES/WMA/wma_ocb.c
@@ -1128,6 +1128,12 @@ static int wma_radio_chan_stats_event_handler(void *handle, u_int8_t *event,
 	if (!chan_stats) {
 		WMA_LOGE("Invalid radio_chan_stats ptr");
 		return -EINVAL;
+
+	if (fix_param->num_chans > (UINT32_MAX - sizeof(*resp))/
+	    sizeof(struct radio_chan_stats_info)) {
+		WMA_LOGE("%s: number of channels = %d greater thanmax limit",
+			  __func__,fix_param->num_chans);
+		return -EINVAL;
 	}
 
 	len = sizeof(*resp) +
-- 
cgit v1.1

