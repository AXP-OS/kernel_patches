From 533b2f5040b313115ae9ff0308d2fd80c5c8f183 Mon Sep 17 00:00:00 2001
From: tinlin <tinlin@codeaurora.org>
Date: Wed, 11 Jul 2018 15:17:10 +0800
Subject: qcacld-2.0: Avoid int overflow in csrScanSavePreferredNetworkFound

Propagation from cld3.0 to cld2.0.

Add validation check on frameLength to avoid int overflow in
csrScanSavePreferredNetworkFound function.

Change-Id: I0f2a0557fa60e81f0b9d003ae73091f2974046e8
CRs-Fixed: 2276595
---
 CORE/SME/src/csr/csrApiScan.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/CORE/SME/src/csr/csrApiScan.c b/CORE/SME/src/csr/csrApiScan.c
index 8df864f..cd85d90 100644
--- a/CORE/SME/src/csr/csrApiScan.c
+++ b/CORE/SME/src/csr/csrApiScan.c
@@ -8490,6 +8490,13 @@ eHalStatus csrScanSavePreferredNetworkFound(tpAniSirGlobal pMac,
           (SIR_MAC_HDR_LEN_3A + SIR_MAC_B_PR_SSID_OFFSET);
    }
 
+   if (uLen > (UINT_MAX - sizeof(tCsrScanResult))) {
+       smsLog(pMac, LOGE,
+              FL("Incorrect len: %d, may leads to int overflow, uLen %d"),
+              pPrefNetworkFoundInd->frameLength, uLen);
+       vos_mem_free(pParsedFrame);
+       return eHAL_STATUS_FAILURE;
+   }
    pScanResult = vos_mem_malloc(sizeof(tCsrScanResult) + uLen);
    if ( NULL == pScanResult )
    {
-- 
cgit v1.1

