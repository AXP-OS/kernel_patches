From b229287c0761c5759c549be38abd99111bc76d0d Mon Sep 17 00:00:00 2001
From: Rakshith Suresh Patkar <rpatkar@codeaurora.org>
Date: Tue, 17 Jul 2018 14:01:10 +0530
Subject: qcacld-2.0: Fix OOB access in htt_rx_ring_fill_n

Validate num and idx variables to avoid OOB access.

Change-Id: I920a3cd12744055cfc8315e3b16f8564a3cf9683
CRs-Fixed: 2278457
---
 CORE/CLD_TXRX/HTT/htt_rx.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/CORE/CLD_TXRX/HTT/htt_rx.c b/CORE/CLD_TXRX/HTT/htt_rx.c
index 2b0bdd0..cb9a566 100644
--- a/CORE/CLD_TXRX/HTT/htt_rx.c
+++ b/CORE/CLD_TXRX/HTT/htt_rx.c
@@ -225,6 +225,13 @@ htt_rx_ring_fill_n(struct htt_pdev_t *pdev, int num)
     struct htt_host_rx_desc_base *rx_desc;
 
     idx = *(pdev->rx_ring.alloc_idx.vaddr);
+
+    if ((idx < 0) || (idx > pdev->rx_ring.size_mask) ||
+        (num > pdev->rx_ring.size))  {
+        adf_os_print("%s:rx refill failed!\n", __func__);
+        return;
+    }
+
     while (num > 0) {
         u_int32_t paddr;
         adf_nbuf_t rx_netbuf;
-- 
cgit v1.1

