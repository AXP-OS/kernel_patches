From c109014c4cf7a06951a9fbdcff501b572d60e42a Mon Sep 17 00:00:00 2001
From: Chunhuan Zhan <zhanc@codeaurora.org>
Date: Mon, 13 Aug 2018 18:02:12 +0800
Subject: msm: ais: change csid to avoid overflow

Check the cid number to be less than MAX_CID in csid.

Change-Id: I16777dc8e8c72e01dc10490cd4c205c939adb7b5
Signed-off-by: Chunhuan Zhan <zhanc@codeaurora.org>
Signed-off-by: Rahul Sharma <rahsha@codeaurora.org>
---
 drivers/media/platform/msm/ais/sensor/csid/msm_csid.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/media/platform/msm/ais/sensor/csid/msm_csid.c b/drivers/media/platform/msm/ais/sensor/csid/msm_csid.c
index b820aa4..c62f622 100644
--- a/drivers/media/platform/msm/ais/sensor/csid/msm_csid.c
+++ b/drivers/media/platform/msm/ais/sensor/csid/msm_csid.c
@@ -812,8 +812,10 @@ static int32_t msm_csid_cmd(struct csid_device *csid_dev, void *arg)
 			unsigned char cid = csid_params.lut_params.vc_cfg_a[i].
 									cid;
 
-			csid_dev->current_csid_params.lut_params.vc_cfg_a[cid] =
-					csid_params.lut_params.vc_cfg_a[i];
+			if (cid < MAX_CID)
+				csid_dev->current_csid_params.lut_params.
+				vc_cfg_a[cid] = csid_params.lut_params.
+				vc_cfg_a[i];
 
 			CDBG("vc_cfg_a[%d] : dt=%d, decode_fmt=%d",
 				csid_params.lut_params.vc_cfg_a[i].cid,
@@ -851,8 +853,10 @@ static int32_t msm_csid_cmd(struct csid_device *csid_dev, void *arg)
 			unsigned char cid = csid_params.lut_params.vc_cfg_a[i].
 						cid;
 
-			csid_dev->current_csid_params.lut_params.vc_cfg_a[cid] =
-				csid_params.lut_params.vc_cfg_a[i];
+			if (cid < MAX_CID)
+				csid_dev->current_csid_params.lut_params.
+				vc_cfg_a[cid] = csid_params.lut_params.
+				vc_cfg_a[i];
 
 			CDBG("vc_cfg_a[%d] : dt=%d, decode_fmt=%d",
 				csid_params.lut_params.vc_cfg_a[i].cid,
-- 
cgit v1.1

