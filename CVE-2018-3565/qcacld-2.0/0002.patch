From 34b6255cd9dffc9e1a409cf79beb2d5d8a2e929a Mon Sep 17 00:00:00 2001
From: "Padma, Santhosh Kumar" <skpadma@codeaurora.org>
Date: Fri, 8 Dec 2017 17:48:10 +0530
Subject: qcacld-2.0: Avoid buffer overflow

qcacld-3.0 to qcacld-2.0 propagation

Add max check for probe request length against max length of probe
request buffer to avoid buffer overflow.

Change-Id: Ie0fad7443b2c749c66bb9ad662625a16d3a840c3
CRs-Fixed: 2155808
---
 CORE/MAC/src/pe/lim/limProcessProbeReqFrame.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/CORE/MAC/src/pe/lim/limProcessProbeReqFrame.c b/CORE/MAC/src/pe/lim/limProcessProbeReqFrame.c
index 8594137..337308b 100644
--- a/CORE/MAC/src/pe/lim/limProcessProbeReqFrame.c
+++ b/CORE/MAC/src/pe/lim/limProcessProbeReqFrame.c
@@ -742,6 +742,10 @@ limSendSmeProbeReqInd(tpAniSirGlobal pMac,
 
     MTRACE(macTrace(pMac, TRACE_CODE_TX_SME_MSG, psessionEntry->peSessionId,
                                                                msgQ.type));
+
+    if (ProbeReqIELen > sizeof(pSirSmeProbeReqInd->WPSPBCProbeReq.probeReqIE))
+        ProbeReqIELen = sizeof(pSirSmeProbeReqInd->WPSPBCProbeReq.probeReqIE);
+
     pSirSmeProbeReqInd->WPSPBCProbeReq.probeReqIELen = (tANI_U16)ProbeReqIELen;
     vos_mem_copy(pSirSmeProbeReqInd->WPSPBCProbeReq.probeReqIE, pProbeReqIE, ProbeReqIELen);
 
-- 
cgit v1.1

