From 6299a6bf166a60a47e9108ae2119027e787432d0 Mon Sep 17 00:00:00 2001
From: gaurank kathpalia <gkathpal@codeaurora.org>
Date: Mon, 23 Oct 2017 19:27:28 +0530
Subject: qcacld-2.0: Fix buffer overwrite in wma_extscan_rsp_handler

In function "wma_extscan_start_stop_event_handler",
variable "event" is coming from the FW, whose content
is copied to variable "buf".Variable "vdev_id" equals
to "event->vdev_id". "vdev_id" is a uint8_t value,
with no limit check, so a buffer overwrite is possible.

Add sanity check for vdev-id  to avoid buffer overwrite

Change-Id: I4af62b6061d2524a2fc67cf0ddb49d3d310db916
CRs-Fixed: 2115207
---
 CORE/SERVICES/WMA/wma.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/CORE/SERVICES/WMA/wma.c b/CORE/SERVICES/WMA/wma.c
index 15322bd..4a1a645 100644
--- a/CORE/SERVICES/WMA/wma.c
+++ b/CORE/SERVICES/WMA/wma.c
@@ -3131,6 +3131,13 @@ static int wma_extscan_rsp_handler(tp_wma_handle wma, uint8_t *buf)
 	}
 
 	event = (wmi_extscan_start_stop_event_fixed_param *)buf;
+
+	if (event->vdev_id >= wma->max_bssid) {
+		WMA_LOGE("%s: max vdev id's %d reached",
+			  __func__, event->vdev_id);
+		return -EINVAL;
+	}
+
 	vdev_id = event->vdev_id;
 	extscan_ind = vos_mem_malloc(sizeof(*extscan_ind));
 	if (!extscan_ind) {
-- 
cgit v1.1

