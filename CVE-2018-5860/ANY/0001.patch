From 940c7552ab06a039512c1b0beeb72ee333220abe Mon Sep 17 00:00:00 2001
From: Jayant Shekhar <jshekhar@codeaurora.org>
Date: Fri, 30 Sep 2016 18:37:46 +0530
Subject: msm: mdss: Memset commit structure in compat path

Memset commit structure in compat path ioctl as some
of the pointer variables might go uninitialized, if not
explicitly initialized by userspace. These uninitialized
variables contain garbage values which can further result
in kernel crash.

Change-Id: I09518a43438e27751f2b918d682f551550c4342e
Signed-off-by: Jayant Shekhar <jshekhar@codeaurora.org>
---
 drivers/video/msm/mdss/mdss_compat_utils.c | 2 ++
 drivers/video/msm/mdss/mdss_compat_utils.h | 2 +-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/video/msm/mdss/mdss_compat_utils.c b/drivers/video/msm/mdss/mdss_compat_utils.c
index 72cb074..88fcabde 100644
--- a/drivers/video/msm/mdss/mdss_compat_utils.c
+++ b/drivers/video/msm/mdss/mdss_compat_utils.c
@@ -314,6 +314,8 @@ static int __compat_atomic_commit(struct fb_info *info, unsigned int cmd,
 		ret = -EFAULT;
 		return ret;
 	}
+
+	memset(&commit, 0, sizeof(struct mdp_layer_commit));
 	__copy_atomic_commit_struct(&commit, &commit32);
 
 	if (commit32.commit_v1.output_layer) {
diff --git a/drivers/video/msm/mdss/mdss_compat_utils.h b/drivers/video/msm/mdss/mdss_compat_utils.h
index 16d40d3..e89142d 100644
--- a/drivers/video/msm/mdss/mdss_compat_utils.h
+++ b/drivers/video/msm/mdss/mdss_compat_utils.h
@@ -534,9 +534,9 @@ struct mdp_layer_commit_v1_32 {
 	uint32_t		input_layer_cnt;
 	compat_caddr_t		output_layer;
 	int			retire_fence;
-	compat_caddr_t		frc_info;
 	compat_caddr_t		dest_scaler;
 	uint32_t                dest_scaler_cnt;
+	compat_caddr_t		frc_info;
 	uint32_t		reserved[MDP_LAYER_COMMIT_V1_PAD];
 };
 
-- 
cgit v1.1

