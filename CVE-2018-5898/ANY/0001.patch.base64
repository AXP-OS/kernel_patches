diff --git a/sound/soc/msm/qdsp6v2/msm-compress-q6-v2.c b/sound/soc/msm/qdsp6v2/msm-compress-q6-v2.c
index 216927b..566d184 100644
--- a/sound/soc/msm/qdsp6v2/msm-compress-q6-v2.c
+++ b/sound/soc/msm/qdsp6v2/msm-compress-q6-v2.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2012-2017, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2012-2018, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -3604,6 +3604,7 @@
 	struct snd_compr_stream *cstream = NULL;
 	struct msm_compr_audio *prtd;
 	int ret = 0, param_length = 0;
+	uint64_t actual_payload_len = 0;
 
 	if (fe_id >= MSM_FRONTEND_DAI_MAX) {
 		pr_err("%s Received invalid fe_id %lu\n",
@@ -3634,6 +3635,15 @@
 
 	memcpy(&param_length, ucontrol->value.bytes.data,
 		sizeof(param_length));
+
+	actual_payload_len = param_length + sizeof(param_length);
+	if (actual_payload_len > U32_MAX) {
+		pr_err("%s param length=0x%X exceeds limit",
+				__func__, param_length);
+		ret = -EINVAL;
+		goto done;
+	}
+
 	if ((param_length + sizeof(param_length))
 		>= sizeof(ucontrol->value.bytes.data)) {
 		pr_err("%s param length=%d  exceeds limit",
diff --git a/sound/soc/msm/qdsp6v2/msm-pcm-q6-v2.c b/sound/soc/msm/qdsp6v2/msm-pcm-q6-v2.c
index d0888ce..7f6dd52 100644
--- a/sound/soc/msm/qdsp6v2/msm-pcm-q6-v2.c
+++ b/sound/soc/msm/qdsp6v2/msm-pcm-q6-v2.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2012-2017, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2012-2018, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -1101,7 +1101,9 @@
 	struct msm_plat_data *pdata = dev_get_drvdata(platform->dev);
 	struct snd_pcm_substream *substream;
 	struct msm_audio *prtd;
-	int ret = 0, param_length = 0;
+	int ret = 0;
+	uint32_t param_length = 0;
+	uint64_t actual_payload_len = 0;
 
 	if (!pdata) {
 		pr_err("%s pdata is NULL\n", __func__);
@@ -1131,6 +1133,16 @@
 
 	memcpy(&param_length, ucontrol->value.bytes.data,
 		sizeof(param_length));
+
+	actual_payload_len = param_length + sizeof(param_length);
+
+	if (actual_payload_len > U32_MAX) {
+		pr_err("%s param length=0x%X exceeds limit",
+		__func__, param_length);
+		ret = -EINVAL;
+		goto done;
+	}
+
 	if ((param_length + sizeof(param_length))
 		>= sizeof(ucontrol->value.bytes.data)) {
 		pr_err("%s param length=%d  exceeds limit",
diff --git a/sound/soc/msm/qdsp6v2/q6asm.c b/sound/soc/msm/qdsp6v2/q6asm.c
index 129053e..6426e0b 100644
--- a/sound/soc/msm/qdsp6v2/q6asm.c
+++ b/sound/soc/msm/qdsp6v2/q6asm.c
@@ -1099,7 +1099,9 @@
 {
 	char *asm_params = NULL;
 	struct apr_hdr hdr;
-	int sz, rc;
+	int rc;
+	uint32_t sz = 0;
+	uint64_t actual_sz = 0;
 
 	if (!param || !ac) {
 		pr_err("%s: %s is NULL\n", __func__,
@@ -1108,7 +1110,15 @@
 		goto done;
 	}
 
-	sz = sizeof(struct apr_hdr) + params_length;
+	actual_sz = sizeof(struct apr_hdr) + params_length;
+	if (actual_sz > U32_MAX) {
+		pr_err("%s: payload size 0x%X exceeds limit\n",
+			__func__, params_length);
+		rc = -EINVAL;
+		goto done;
+	}
+
+	sz = (uint32_t)actual_sz;
 	asm_params = kzalloc(sz, GFP_KERNEL);
 	if (!asm_params) {
 		rc = -ENOMEM;
