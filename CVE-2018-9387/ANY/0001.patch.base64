diff --git a/drivers/misc/mnh/mnh-sm.c b/drivers/misc/mnh/mnh-sm.c
index ff8042c..5237905 100644
--- a/drivers/misc/mnh/mnh-sm.c
+++ b/drivers/misc/mnh/mnh-sm.c
@@ -203,6 +203,9 @@
 
 	/* firmware version */
 	char mnh_fw_ver[FW_VER_SIZE];
+
+	/* serialize fw update requests */
+	struct mutex fw_update_lock;
 };
 
 static struct mnh_sm_device *mnh_sm_dev;
@@ -840,9 +843,17 @@
 	for (i = 0; i < MAX_NR_MNH_FW_SLOTS; i++) {
 		config = configs.config[i];
 		slot = config.slot_type;
+		if ((slot < 0) || (slot >= MAX_NR_MNH_FW_SLOTS))
+			return -EINVAL;
+
+		if (!((config.size > 0) &&
+		     (config.size < MNH_ION_BUFFER_SIZE) &&
+		     (config.offset >= 0) &&
+		     (config.offset < (MNH_ION_BUFFER_SIZE - config.size))))
+			return -EINVAL;
+
 		/* only configure slots masked by FW_SLOT_UPDATE_MASK */
-		if ((FW_SLOT_UPDATE_MASK & (1 << slot)) &&
-		    (config.size > 0)) {
+		if (FW_SLOT_UPDATE_MASK & (1 << slot)) {
 			mnh_sm_dev->ion[fw_idx]->fw_array[slot].ap_offs =
 				config.offset;
 			mnh_sm_dev->ion[fw_idx]->fw_array[slot].size =
@@ -1977,6 +1988,7 @@
 			mnh_mipi_stop(mnh_sm_dev->dev, mipi_config);
 		break;
 	case MNH_SM_IOC_GET_UPDATE_BUF:
+		mutex_lock(&mnh_sm_dev->fw_update_lock);
 		mnh_sm_dev->ion[FW_PART_SEC]->is_fw_ready = false;
 		if (mnh_sm_dev->ion[FW_PART_SEC]) {
 			if (mnh_ion_create_buffer(mnh_sm_dev->ion[FW_PART_SEC],
@@ -1995,17 +2007,21 @@
 			dev_err(mnh_sm_dev->dev,
 				"%s: failed to copy to userspace (%d)\n",
 				__func__, err);
+			mutex_unlock(&mnh_sm_dev->fw_update_lock);
 			return err;
 		}
 		mnh_sm_dev->update_status = FW_UPD_INIT;
+		mutex_unlock(&mnh_sm_dev->fw_update_lock);
 		break;
 	case MNH_SM_IOC_POST_UPDATE_BUF:
+		mutex_lock(&mnh_sm_dev->fw_update_lock);
 		err = copy_from_user(&update_configs, (void __user *)arg,
 				     sizeof(update_configs));
 		if (err) {
 			dev_err(mnh_sm_dev->dev,
 				"%s: failed to copy from userspace (%d)\n",
 				__func__, err);
+			mutex_unlock(&mnh_sm_dev->fw_update_lock);
 			return err;
 		}
 		if (mnh_sm_dev->update_status == FW_UPD_INIT) {
@@ -2018,10 +2034,12 @@
 				dev_err(mnh_sm_dev->dev,
 					"%s: failed to validate slots (%d)\n",
 					__func__, err);
+				mutex_unlock(&mnh_sm_dev->fw_update_lock);
 				return err;
 			}
 			mnh_sm_dev->update_status = FW_UPD_VERIFIED;
 		}
+		mutex_unlock(&mnh_sm_dev->fw_update_lock);
 		break;
 	case MNH_SM_IOC_GET_FW_VER:
 		err = copy_to_user((void __user *)arg, &mnh_sm_dev->mnh_fw_ver,
@@ -2144,6 +2162,7 @@
 
 	/* initialize driver structures */
 	mutex_init(&mnh_sm_dev->lock);
+	mutex_init(&mnh_sm_dev->fw_update_lock);
 	init_completion(&mnh_sm_dev->powered_complete);
 	init_completion(&mnh_sm_dev->work_complete);
 	init_completion(&mnh_sm_dev->suspend_complete);
