From b97daddd9df394babdd23e12370efa56315c2cc9 Mon Sep 17 00:00:00 2001
From: Al Viro <viro@zeniv.linux.org.uk>
Date: Sun, 12 Aug 2012 17:18:05 -0400
Subject: [PATCH] make get_unused_fd_flags() a function

... and get_unused_fd() a macro around it

Issue: SEC-1728
Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Change-Id: Ied797d8b016f6404d2b29fe7ffc7c0fbe3d3eccd
(cherry picked from commit 1a7bd2265fc57f29400d57f66275cc5918e30aa6)
---
 fs/file.c            | 6 +++---
 include/linux/file.h | 4 ++--
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/fs/file.c b/fs/file.c
index dcbc172ccca..321048cc820 100644
--- a/fs/file.c
+++ b/fs/file.c
@@ -478,8 +478,8 @@ int alloc_fd(unsigned start, unsigned flags)
 }
 EXPORT_SYMBOL(alloc_fd);
 
-int get_unused_fd(void)
+int get_unused_fd_flags(unsigned flags)
 {
-	return alloc_fd(0, 0);
+	return alloc_fd(0, flags);
 }
-EXPORT_SYMBOL(get_unused_fd);
+EXPORT_SYMBOL(get_unused_fd_flags);
diff --git a/include/linux/file.h b/include/linux/file.h
index 4341818e5e7..26dc9d979b8 100644
--- a/include/linux/file.h
+++ b/include/linux/file.h
@@ -59,8 +59,8 @@ static inline struct fd fdget_raw(unsigned int fd)
 extern void set_close_on_exec(unsigned int fd, int flag);
 extern void put_filp(struct file *);
 extern int alloc_fd(unsigned start, unsigned flags);
-extern int get_unused_fd(void);
-#define get_unused_fd_flags(flags) alloc_fd(0, (flags))
+extern int get_unused_fd_flags(unsigned flags);
+#define get_unused_fd() get_unused_fd_flags(0)
 extern void put_unused_fd(unsigned int fd);
 
 extern void fd_install(unsigned int fd, struct file *file);
