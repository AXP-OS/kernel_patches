From 38934e6bfb2f8146a567870ae83cea6783feb938 Mon Sep 17 00:00:00 2001
From: Qun Zhang <qunz@codeaurora.org>
Date: Tue, 4 Sep 2018 15:21:28 +0800
Subject: qcacld-2.0: Add some missed changes in previous submit 2402998

propagation from qcacld-3.0 to qcacld-2.0

In function dot11f_unpack functions length of buffer passed is
decremented as pointer advances in the buffer. Add a check for
integer underflow before decrementing the length.

qcacld-3.0 to CLD2.0 propagation of the following CRs:
2237141, 2231755, 2246426, 2150438

Change-Id: I5daed783abf42b2632201d94e411af11f192c25f
CRs-Fixed: 2259649
---
 CORE/SYS/legacy/src/utils/src/dot11f.c | 174 +++++++++++++++++++++++++++++++++
 1 file changed, 174 insertions(+)

diff --git a/CORE/SYS/legacy/src/utils/src/dot11f.c b/CORE/SYS/legacy/src/utils/src/dot11f.c
index efae008..5277bfb 100644
--- a/CORE/SYS/legacy/src/utils/src/dot11f.c
+++ b/CORE/SYS/legacy/src/utils/src/dot11f.c
@@ -24580,6 +24580,9 @@ tANI_U32 dot11fPackTlvVersion2(tpAniSirGlobal pCtx,
         tmp78__ |= ( pSrc->minor << 0 );
         tmp78__ |= ( pSrc->major << 4 );
         *pBuf = tmp78__;
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pnConsumed += 1;
         pBuf += 1;
         nBuf -=  1 ;
@@ -25801,6 +25804,9 @@ tANI_U32 dot11fPackTlvVersion(tpAniSirGlobal pCtx,
         tmp79__ |= ( pSrc->minor << 0 );
         tmp79__ |= ( pSrc->major << 4 );
         *pBuf = tmp79__;
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pnConsumed += 1;
         pBuf += 1;
         nBuf -=  1 ;
@@ -25956,6 +25962,9 @@ tANI_U32 dot11fPackIeGTK(tpAniSirGlobal pCtx,
         tmp80__ |= ( pSrc->keyId << 0 );
         tmp80__ |= ( pSrc->reserved << 2 );
         frameshtons(pCtx, pBuf, tmp80__, 0);
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         *pnConsumed += 2;
         pBuf += 2;
         nBuf -=  2 ;
@@ -26402,6 +26411,9 @@ tANI_U32 dot11fPackIeRRMEnabledCap(tpAniSirGlobal pCtx,
         tmp81__ |= ( pSrc->BeaconActive << 5 );
         tmp81__ |= ( pSrc->BeaconTable << 6 );
         tmp81__ |= ( pSrc->BeaconRepCond << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp81__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -26415,6 +26427,9 @@ tANI_U32 dot11fPackIeRRMEnabledCap(tpAniSirGlobal pCtx,
         tmp82__ |= ( pSrc->LCIAzimuth << 5 );
         tmp82__ |= ( pSrc->TCMCapability << 6 );
         tmp82__ |= ( pSrc->triggeredTCM << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp82__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -26424,6 +26439,9 @@ tANI_U32 dot11fPackIeRRMEnabledCap(tpAniSirGlobal pCtx,
         tmp83__ |= ( pSrc->RRMMIBEnabled << 1 );
         tmp83__ |= ( pSrc->operatingChanMax << 2 );
         tmp83__ |= ( pSrc->nonOperatinChanMax << 5 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp83__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -26435,6 +26453,9 @@ tANI_U32 dot11fPackIeRRMEnabledCap(tpAniSirGlobal pCtx,
         tmp84__ |= ( pSrc->RCPIMeasurement << 5 );
         tmp84__ |= ( pSrc->RSNIMeasurement << 6 );
         tmp84__ |= ( pSrc->BssAvgAccessDelay << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp84__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -26445,6 +26466,9 @@ tANI_U32 dot11fPackIeRRMEnabledCap(tpAniSirGlobal pCtx,
         tmp85__ |= ( pSrc->fine_time_meas_rpt << 2 );
         tmp85__ |= ( pSrc->lci_capability << 3 );
         tmp85__ |= ( pSrc->reserved << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp85__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -26543,6 +26567,9 @@ tANI_U32 dot11fPackIeSchedule(tpAniSirGlobal pCtx,
         tmp86__ |= ( pSrc->direction << 5 );
         tmp86__ |= ( pSrc->reserved << 7 );
         frameshtons(pCtx, pBuf, tmp86__, 0);
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         *pnConsumed += 2;
         pBuf += 2;
         nBuf -=  2 ;
@@ -26762,6 +26789,9 @@ tANI_U32 dot11fPackIeTSPEC(tpAniSirGlobal pCtx,
         tmp87__ |= ( pSrc->psb << 10 );
         tmp87__ |= ( pSrc->user_priority << 11 );
         tmp87__ |= ( pSrc->tsinfo_ack_pol << 14 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp87__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -26769,6 +26799,9 @@ tANI_U32 dot11fPackIeTSPEC(tpAniSirGlobal pCtx,
         tmp88__ = 0U;
         tmp88__ |= ( pSrc->schedule << 0 );
         tmp88__ |= ( pSrc->unused << 1 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp88__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -26776,6 +26809,9 @@ tANI_U32 dot11fPackIeTSPEC(tpAniSirGlobal pCtx,
         tmp89__ = 0U;
         tmp89__ |= ( pSrc->size << 0 );
         tmp89__ |= ( pSrc->fixed << 15 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp89__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -26873,6 +26909,9 @@ tANI_U32 dot11fPackIeVHTCaps(tpAniSirGlobal pCtx,
         tmp90__ |= ( pSrc->rxAntPattern << 28 );
         tmp90__ |= ( pSrc->txAntPattern << 29 );
         tmp90__ |= ( pSrc->reserved1 << 30 );
+        if (unlikely(nBuf < 4))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtonl(pCtx, pBuf, tmp90__, 0);
         *pnConsumed += 4;
         pBuf += 4;
@@ -26883,6 +26922,9 @@ tANI_U32 dot11fPackIeVHTCaps(tpAniSirGlobal pCtx,
         tmp91__ = 0U;
         tmp91__ |= ( pSrc->rxHighSupDataRate << 0 );
         tmp91__ |= ( pSrc->reserved2 << 13 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp91__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -26893,6 +26935,9 @@ tANI_U32 dot11fPackIeVHTCaps(tpAniSirGlobal pCtx,
         tmp92__ = 0U;
         tmp92__ |= ( pSrc->txSupDataRate << 0 );
         tmp92__ |= ( pSrc->reserved3 << 13 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp92__, 0);
         *pnConsumed += 2;
         // fieldsEndFlag  = 1
@@ -26982,6 +27027,9 @@ tANI_U32 dot11fPackIeWMMSchedule(tpAniSirGlobal pCtx,
         tmp93__ |= ( pSrc->tsid << 1 );
         tmp93__ |= ( pSrc->direction << 5 );
         tmp93__ |= ( pSrc->reserved << 7 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp93__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -27254,6 +27302,9 @@ tANI_U32 dot11fPackIeWMMTSPEC(tpAniSirGlobal pCtx,
         tmp94__ |= ( pSrc->psb << 10 );
         tmp94__ |= ( pSrc->user_priority << 11 );
         tmp94__ |= ( pSrc->tsinfo_ack_pol << 14 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp94__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -27261,6 +27312,9 @@ tANI_U32 dot11fPackIeWMMTSPEC(tpAniSirGlobal pCtx,
         tmp95__ = 0U;
         tmp95__ |= ( pSrc->tsinfo_rsvd << 0 );
         tmp95__ |= ( pSrc->burst_size_defn << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp95__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -27268,6 +27322,9 @@ tANI_U32 dot11fPackIeWMMTSPEC(tpAniSirGlobal pCtx,
         tmp96__ = 0U;
         tmp96__ |= ( pSrc->size << 0 );
         tmp96__ |= ( pSrc->fixed << 15 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp96__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -27654,6 +27711,9 @@ tANI_U32 dot11fPackIeEDCAParamSet(tpAniSirGlobal pCtx,
         tmp99__ |= ( pSrc->acbk_acm << 4 );
         tmp99__ |= ( pSrc->acbk_aci << 5 );
         tmp99__ |= ( pSrc->unused2 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp99__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -27661,6 +27721,9 @@ tANI_U32 dot11fPackIeEDCAParamSet(tpAniSirGlobal pCtx,
         tmp100__ = 0U;
         tmp100__ |= ( pSrc->acbk_acwmin << 0 );
         tmp100__ |= ( pSrc->acbk_acwmax << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp100__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -27673,6 +27736,9 @@ tANI_U32 dot11fPackIeEDCAParamSet(tpAniSirGlobal pCtx,
         tmp101__ |= ( pSrc->acvi_acm << 4 );
         tmp101__ |= ( pSrc->acvi_aci << 5 );
         tmp101__ |= ( pSrc->unused3 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp101__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -27680,6 +27746,9 @@ tANI_U32 dot11fPackIeEDCAParamSet(tpAniSirGlobal pCtx,
         tmp102__ = 0U;
         tmp102__ |= ( pSrc->acvi_acwmin << 0 );
         tmp102__ |= ( pSrc->acvi_acwmax << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp102__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -27692,6 +27761,9 @@ tANI_U32 dot11fPackIeEDCAParamSet(tpAniSirGlobal pCtx,
         tmp103__ |= ( pSrc->acvo_acm << 4 );
         tmp103__ |= ( pSrc->acvo_aci << 5 );
         tmp103__ |= ( pSrc->unused4 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp103__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -27699,6 +27771,9 @@ tANI_U32 dot11fPackIeEDCAParamSet(tpAniSirGlobal pCtx,
         tmp104__ = 0U;
         tmp104__ |= ( pSrc->acvo_acwmin << 0 );
         tmp104__ |= ( pSrc->acvo_acwmax << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp104__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -27739,6 +27814,9 @@ tANI_U32 dot11fPackIeERPInfo(tpAniSirGlobal pCtx,
         tmp105__ |= ( pSrc->use_prot << 1 );
         tmp105__ |= ( pSrc->barker_preamble << 2 );
         tmp105__ |= ( pSrc->unused << 3 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp105__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -27823,6 +27901,9 @@ tANI_U32 dot11fPackIeESERadMgmtCap(tpAniSirGlobal pCtx,
         tmp106__ = 0U;
         tmp106__ |= ( pSrc->mbssid_mask << 0 );
         tmp106__ |= ( pSrc->reserved << 3 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp106__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -28198,6 +28279,9 @@ tANI_U32 dot11fPackIeFTInfo(tpAniSirGlobal pCtx,
         tmp107__ = 0U;
         tmp107__ |= ( pSrc->reserved << 0 );
         tmp107__ |= ( pSrc->IECount << 8 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp107__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -28253,6 +28337,9 @@ tANI_U32 dot11fPackIeHT2040BSSCoexistence(tpAniSirGlobal pCtx,
         tmp108__ |= ( pSrc->obssScanExemptionReq << 3 );
         tmp108__ |= ( pSrc->obssScanExemptionGrant << 4 );
         tmp108__ |= ( pSrc->unused << 5 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp108__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -28337,6 +28424,9 @@ tANI_U32 dot11fPackIeHTCaps(tpAniSirGlobal pCtx,
         tmp109__ |= ( pSrc->psmp << 13 );
         tmp109__ |= ( pSrc->stbcControlFrame << 14 );
         tmp109__ |= ( pSrc->lsigTXOPProtection << 15 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp109__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -28345,6 +28435,9 @@ tANI_U32 dot11fPackIeHTCaps(tpAniSirGlobal pCtx,
         tmp110__ |= ( pSrc->maxRxAMPDUFactor << 0 );
         tmp110__ |= ( pSrc->mpduDensity << 2 );
         tmp110__ |= ( pSrc->reserved1 << 5 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp110__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -28358,6 +28451,9 @@ tANI_U32 dot11fPackIeHTCaps(tpAniSirGlobal pCtx,
         tmp111__ |= ( pSrc->reserved2 << 3 );
         tmp111__ |= ( pSrc->mcsFeedback << 8 );
         tmp111__ |= ( pSrc->reserved3 << 10 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp111__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -28379,6 +28475,9 @@ tANI_U32 dot11fPackIeHTCaps(tpAniSirGlobal pCtx,
         tmp112__ |= ( pSrc->uncompressedSteeringMatrixBFAntennae << 21 );
         tmp112__ |= ( pSrc->compressedSteeringMatrixBFAntennae << 23 );
         tmp112__ |= ( pSrc->reserved4 << 25 );
+        if (unlikely(nBuf < 4))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtonl(pCtx, pBuf, tmp112__, 0);
         *pnConsumed += 4;
         pBuf += 4;
@@ -28392,6 +28491,9 @@ tANI_U32 dot11fPackIeHTCaps(tpAniSirGlobal pCtx,
         tmp113__ |= ( pSrc->rxAS << 5 );
         tmp113__ |= ( pSrc->txSoundingPPDUs << 6 );
         tmp113__ |= ( pSrc->reserved5 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp113__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -28438,6 +28540,9 @@ tANI_U32 dot11fPackIeHTInfo(tpAniSirGlobal pCtx,
         tmp114__ |= ( pSrc->rifsMode << 3 );
         tmp114__ |= ( pSrc->controlledAccessOnly << 4 );
         tmp114__ |= ( pSrc->serviceIntervalGranularity << 5 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp114__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -28448,6 +28553,9 @@ tANI_U32 dot11fPackIeHTInfo(tpAniSirGlobal pCtx,
         tmp115__ |= ( pSrc->transmitBurstLimit << 3 );
         tmp115__ |= ( pSrc->obssNonHTStaPresent << 4 );
         tmp115__ |= ( pSrc->reserved << 5 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp115__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -28460,6 +28568,9 @@ tANI_U32 dot11fPackIeHTInfo(tpAniSirGlobal pCtx,
         tmp116__ |= ( pSrc->pcoActive << 10 );
         tmp116__ |= ( pSrc->pcoPhase << 11 );
         tmp116__ |= ( pSrc->reserved2 << 12 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp116__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -28576,6 +28687,9 @@ tANI_U32 dot11fPackIeMeasurementReport(tpAniSirGlobal pCtx,
         tmp117__ |= ( pSrc->incapable << 1 );
         tmp117__ |= ( pSrc->refused << 2 );
         tmp117__ |= ( pSrc->unused << 3 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp117__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -28603,6 +28717,9 @@ tANI_U32 dot11fPackIeMeasurementReport(tpAniSirGlobal pCtx,
                     tmp118__ |= ( pSrc->report.Basic.rader << 3 );
                     tmp118__ |= ( pSrc->report.Basic.unmeasured << 4 );
                     tmp118__ |= ( pSrc->report.Basic.unused << 5 );
+                    if (unlikely(nBuf < 1))
+                        return DOT11F_INCOMPLETE_IE;
+
                     *pBuf = tmp118__;
                     *pnConsumed += 1;
                     // fieldsEndFlag  = 1
@@ -28673,6 +28790,9 @@ tANI_U32 dot11fPackIeMeasurementReport(tpAniSirGlobal pCtx,
                     tmp119__ = 0U;
                     tmp119__ |= ( pSrc->report.Beacon.condensed_PHY << 0 );
                     tmp119__ |= ( pSrc->report.Beacon.reported_frame_type << 7 );
+                    if (unlikely(nBuf < 1))
+                        return DOT11F_INCOMPLETE_IE;
+
                     *pBuf = tmp119__;
                     *pnConsumed += 1;
                     pBuf += 1;
@@ -28743,6 +28863,9 @@ tANI_U32 dot11fPackIeMeasurementRequest(tpAniSirGlobal pCtx,
         tmp120__ |= ( pSrc->report << 3 );
         tmp120__ |= ( pSrc->durationMandatory << 4 );
         tmp120__ |= ( pSrc->unused << 5 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp120__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -28848,6 +28971,9 @@ tANI_U32 dot11fPackIeMobilityDomain(tpAniSirGlobal pCtx,
         tmp121__ |= ( pSrc->overDSCap << 0 );
         tmp121__ |= ( pSrc->resourceReqCap << 1 );
         tmp121__ |= ( pSrc->reserved << 2 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp121__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -28894,6 +29020,9 @@ tANI_U32 dot11fPackIeNeighborReport(tpAniSirGlobal pCtx,
         tmp122__ |= ( pSrc->QosCap << 5 );
         tmp122__ |= ( pSrc->apsd << 6 );
         tmp122__ |= ( pSrc->rrm << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp122__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -28903,6 +29032,9 @@ tANI_U32 dot11fPackIeNeighborReport(tpAniSirGlobal pCtx,
         tmp123__ |= ( pSrc->ImmBA << 1 );
         tmp123__ |= ( pSrc->MobilityDomain << 2 );
         tmp123__ |= ( pSrc->reserved << 3 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp123__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -29007,6 +29139,9 @@ tANI_U32 dot11fPackIeOperatingMode(tpAniSirGlobal pCtx,
         tmp124__ |= ( pSrc->reserved << 2 );
         tmp124__ |= ( pSrc->rxNSS << 4 );
         tmp124__ |= ( pSrc->rxNSSType << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp124__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -29976,6 +30111,9 @@ tANI_U32 dot11fPackIePUBufferStatus(tpAniSirGlobal pCtx,
         tmp125__ |= ( pSrc->ac_vi_traffic_aval << 2 );
         tmp125__ |= ( pSrc->ac_vo_traffic_aval << 3 );
         tmp125__ |= ( pSrc->reserved << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp125__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -30152,6 +30290,9 @@ tANI_U32 dot11fPackIeQOSCapsAp(tpAniSirGlobal pCtx,
         tmp126__ |= ( pSrc->qreq << 5 );
         tmp126__ |= ( pSrc->txopreq << 6 );
         tmp126__ |= ( pSrc->reserved << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp126__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -30192,6 +30333,9 @@ tANI_U32 dot11fPackIeQOSCapsStation(tpAniSirGlobal pCtx,
         tmp127__ |= ( pSrc->qack << 4 );
         tmp127__ |= ( pSrc->max_sp_length << 5 );
         tmp127__ |= ( pSrc->more_data_ack << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp127__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -30872,6 +31016,9 @@ tANI_U32 dot11fPackIeWAPI(tpAniSirGlobal pCtx,
         tmp128__ = 0U;
         tmp128__ |= ( pSrc->preauth << 0 );
         tmp128__ |= ( pSrc->reserved << 1 );
+        if (unlikely(nBuf < 2))
+            return DOT11F_INCOMPLETE_IE;
+
         frameshtons(pCtx, pBuf, tmp128__, 0);
         *pnConsumed += 2;
         pBuf += 2;
@@ -31043,6 +31190,9 @@ tANI_U32 dot11fPackIeWMMCaps(tpAniSirGlobal pCtx,
         tmp129__ |= ( pSrc->queue_request << 5 );
         tmp129__ |= ( pSrc->txop_request << 6 );
         tmp129__ |= ( pSrc->more_ack << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp129__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -31092,6 +31242,9 @@ tANI_U32 dot11fPackIeWMMInfoAp(tpAniSirGlobal pCtx,
         tmp130__ |= ( pSrc->param_set_count << 0 );
         tmp130__ |= ( pSrc->reserved << 4 );
         tmp130__ |= ( pSrc->uapsd << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp130__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -31145,6 +31298,9 @@ tANI_U32 dot11fPackIeWMMInfoStation(tpAniSirGlobal pCtx,
         tmp131__ |= ( pSrc->reserved1 << 4 );
         tmp131__ |= ( pSrc->max_sp_length << 5 );
         tmp131__ |= ( pSrc->reserved2 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp131__;
         *pnConsumed += 1;
         // fieldsEndFlag  = 1
@@ -31227,6 +31383,9 @@ tANI_U32 dot11fPackIeWMMParams(tpAniSirGlobal pCtx,
         tmp134__ |= ( pSrc->acbk_acm << 4 );
         tmp134__ |= ( pSrc->acbk_aci << 5 );
         tmp134__ |= ( pSrc->unused2 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp134__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -31234,6 +31393,9 @@ tANI_U32 dot11fPackIeWMMParams(tpAniSirGlobal pCtx,
         tmp135__ = 0U;
         tmp135__ |= ( pSrc->acbk_acwmin << 0 );
         tmp135__ |= ( pSrc->acbk_acwmax << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp135__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -31246,6 +31408,9 @@ tANI_U32 dot11fPackIeWMMParams(tpAniSirGlobal pCtx,
         tmp136__ |= ( pSrc->acvi_acm << 4 );
         tmp136__ |= ( pSrc->acvi_aci << 5 );
         tmp136__ |= ( pSrc->unused3 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp136__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -31253,6 +31418,9 @@ tANI_U32 dot11fPackIeWMMParams(tpAniSirGlobal pCtx,
         tmp137__ = 0U;
         tmp137__ |= ( pSrc->acvi_acwmin << 0 );
         tmp137__ |= ( pSrc->acvi_acwmax << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp137__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -31265,6 +31433,9 @@ tANI_U32 dot11fPackIeWMMParams(tpAniSirGlobal pCtx,
         tmp138__ |= ( pSrc->acvo_acm << 4 );
         tmp138__ |= ( pSrc->acvo_aci << 5 );
         tmp138__ |= ( pSrc->unused4 << 7 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp138__;
         *pnConsumed += 1;
         pBuf += 1;
@@ -31272,6 +31443,9 @@ tANI_U32 dot11fPackIeWMMParams(tpAniSirGlobal pCtx,
         tmp139__ = 0U;
         tmp139__ |= ( pSrc->acvo_acwmin << 0 );
         tmp139__ |= ( pSrc->acvo_acwmax << 4 );
+        if (unlikely(nBuf < 1))
+            return DOT11F_INCOMPLETE_IE;
+
         *pBuf = tmp139__;
         *pnConsumed += 1;
         pBuf += 1;
-- 
cgit v1.1

