From bbf59266a0038edde8519f708fa545e526198492 Mon Sep 17 00:00:00 2001
From: Hareesh Gundu <hareeshg@codeaurora.org>
Date: Tue, 25 Sep 2018 00:05:07 +0530
Subject: msm: kgsl: Add LLC support for A608 GPU

For A608 GPU, SCID configuration registers have moved from CX_MISC
to GBIF register space. And the GPU HTW SCID is configured via
NoC override in XBL image.

And, LLC page attributes override through GBIF is not supported
with MMU-500. Skip this override setting for A608 which
has the GBIF and MMU-500.

Also, use DOMAIN_ATTR_USE_LLC_NWA attribute for GPU traffic and
page table walk to be read-allocate, write-no-allocate.

Change-Id: I4d01d7929912c43cdf928b71eb3a5a988a54922a
Signed-off-by: Hareesh Gundu <hareeshg@codeaurora.org>
Signed-off-by: Akhil P Oommen <akhilpo@codeaurora.org>
---
 drivers/gpu/msm/adreno_a6xx.c | 6 +++---
 drivers/gpu/msm/kgsl_iommu.c  | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/msm/adreno_a6xx.c b/drivers/gpu/msm/adreno_a6xx.c
index d72ce82..ba3892b 100644
--- a/drivers/gpu/msm/adreno_a6xx.c
+++ b/drivers/gpu/msm/adreno_a6xx.c
@@ -1627,7 +1627,7 @@ static void a6xx_llc_configure_gpu_scid(struct adreno_device *adreno_dev)
 		gpu_cntl1_val = (gpu_cntl1_val << A6XX_GPU_LLC_SCID_NUM_BITS)
 			| gpu_scid;
 
-	if (adreno_is_a640(adreno_dev)) {
+	if (adreno_is_a640(adreno_dev) || adreno_is_a608(adreno_dev)) {
 		kgsl_regrmw(KGSL_DEVICE(adreno_dev), A6XX_GBIF_SCACHE_CNTL1,
 			A6XX_GPU_LLC_SCID_MASK, gpu_cntl1_val);
 	} else {
@@ -1654,7 +1654,7 @@ static void a6xx_llc_configure_gpuhtw_scid(struct adreno_device *adreno_dev)
 	 * On A640, the GPUHTW SCID is configured via a NoC override in the
 	 * XBL image.
 	 */
-	if (adreno_is_a640(adreno_dev))
+	if (adreno_is_a640(adreno_dev) || adreno_is_a608(adreno_dev))
 		return;
 
 	gpuhtw_scid = adreno_llc_get_scid(adreno_dev->gpuhtw_llc_slice);
@@ -1678,7 +1678,7 @@ static void a6xx_llc_enable_overrides(struct adreno_device *adreno_dev)
 	 * Attributes override through GBIF is not supported with MMU-500.
 	 * Attributes are used as configured through SMMU pagetable entries.
 	 */
-	if (adreno_is_a640(adreno_dev))
+	if (adreno_is_a640(adreno_dev) || adreno_is_a608(adreno_dev))
 		return;
 
 	/*
diff --git a/drivers/gpu/msm/kgsl_iommu.c b/drivers/gpu/msm/kgsl_iommu.c
index e60f9a2..1c6a17e 100644
--- a/drivers/gpu/msm/kgsl_iommu.c
+++ b/drivers/gpu/msm/kgsl_iommu.c
@@ -1182,7 +1182,7 @@ void _enable_gpuhtw_llc(struct kgsl_mmu *mmu, struct kgsl_iommu_pt *iommu_pt)
 		return;
 
 	/* Domain attribute to enable system cache for GPU pagetable walks */
-	if (adreno_is_a640(adreno_dev))
+	if (adreno_is_a640(adreno_dev) || adreno_is_a608(adreno_dev))
 		ret = iommu_domain_set_attr(iommu_pt->domain,
 			DOMAIN_ATTR_USE_LLC_NWA, &gpuhtw_llc_enable);
 	else
-- 
cgit v1.1

