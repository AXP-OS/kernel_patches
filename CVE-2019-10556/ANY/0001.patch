From 0332c85157bb7e48793b9a5cd3bfdc22b6826d63 Mon Sep 17 00:00:00 2001
From: Nirmal Abraham <nabrah@codeaurora.org>
Date: Wed, 22 May 2019 10:09:34 +0530
Subject: drm/msm/dsi-staging: Add range check in debugfs_dump_info_read

Add a check to make sure that the length of bytes copied
to the destination buffer doesn't exceed the requested
buffer length before calling the copy_to_user to avoid
buffer overflow.

Change-Id: Icd65b9be2791a8a487dfc8d7461aadce61de3f1b
Signed-off-by: Nirmal Abraham <nabrah@codeaurora.org>
---
 drivers/gpu/drm/msm/dsi-staging/dsi_display.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/gpu/drm/msm/dsi-staging/dsi_display.c b/drivers/gpu/drm/msm/dsi-staging/dsi_display.c
index 623ba99..8398100 100644
--- a/drivers/gpu/drm/msm/dsi-staging/dsi_display.c
+++ b/drivers/gpu/drm/msm/dsi-staging/dsi_display.c
@@ -1116,6 +1116,9 @@ static ssize_t debugfs_dump_info_read(struct file *file,
 			"\tClock master = %s\n",
 			display->ctrl[display->clk_master_idx].ctrl->name);
 
+	if (len > user_len)
+		len = user_len;
+
 	if (copy_to_user(user_buf, buf, len)) {
 		kfree(buf);
 		return -EFAULT;
-- 
cgit v1.1

