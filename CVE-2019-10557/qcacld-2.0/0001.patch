From 0de8c3496eb416f099836c64721dd3fcf66cb5bb Mon Sep 17 00:00:00 2001
From: tinlin <tinlin@codeaurora.org>
Date: Tue, 16 Oct 2018 13:40:45 +0800
Subject: qcacld-2.0: Fix possible OOB access in lim_process_assoc_req_frame

Propagation from cld3.0 driver to cld2.0 driver.

cfg_get_vendor_ie_ptr_from_oui is invoked in
limProcessAssocReqFrame function with ie
pointer pointing to frame buffer plus assoc
req ie offset and ie len equal to frame buffer
len. This could result in OOB access since
offset is not subtracted from frame len.
Fix is to subtract the offset from frame len
as argument to cfg_get_vendor_ie_ptr_from_oui.

Change-Id: Ic107867bcf4d7813c544309a2aff165f2dc7155d
CRs-Fixed: 2333887
---
 CORE/MAC/src/pe/lim/limProcessAssocReqFrame.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/CORE/MAC/src/pe/lim/limProcessAssocReqFrame.c b/CORE/MAC/src/pe/lim/limProcessAssocReqFrame.c
index 23d2cf3..ab1a5ce 100644
--- a/CORE/MAC/src/pe/lim/limProcessAssocReqFrame.c
+++ b/CORE/MAC/src/pe/lim/limProcessAssocReqFrame.c
@@ -384,7 +384,8 @@ limProcessAssocReqFrame(tpAniSirGlobal pMac, tANI_U8 *pRxPacketInfo,
              LIM_ACCESS_POLICY_RESPOND_IF_IE_IS_PRESENT)) {
         if (!cfg_get_vendor_ie_ptr_from_oui(pMac,
                     &psessionEntry->access_policy_vendor_ie[2],
-                    3, pBody + LIM_ASSOC_REQ_IE_OFFSET, framelen)) {
+                    3, pBody + LIM_ASSOC_REQ_IE_OFFSET,
+                    framelen - LIM_ASSOC_REQ_IE_OFFSET)) {
             limLog(pMac, LOGE,
                     FL("Vendor ie not present and access policy is %x, Rejected association"),
                     psessionEntry->access_policy);
-- 
cgit v1.1

