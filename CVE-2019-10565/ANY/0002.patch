From 3325e66fd28060cb1d92fa66d553837296d13003 Mon Sep 17 00:00:00 2001
From: Vivek Veenam <vveenam@codeaurora.org>
Date: Fri, 13 Apr 2018 16:58:43 +0530
Subject: msm: camera: Add NULL check before accessing power settings

Sensor power settings can be freed by some thread while another
thread try to access it. Add NULL check before to prevent this.

Change-Id: Ice3d8c6da65afd5196be67860543eb974183c55e
Signed-off-by: Vivek Veenam <vveenam@codeaurora.org>
---
 .../cam_sensor_module/cam_sensor_utils/cam_sensor_util.c       | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/drivers/media/platform/msm/camera/cam_sensor_module/cam_sensor_utils/cam_sensor_util.c b/drivers/media/platform/msm/camera/cam_sensor_module/cam_sensor_utils/cam_sensor_util.c
index a399963..10d29c9 100644
--- a/drivers/media/platform/msm/camera/cam_sensor_module/cam_sensor_utils/cam_sensor_util.c
+++ b/drivers/media/platform/msm/camera/cam_sensor_module/cam_sensor_utils/cam_sensor_util.c
@@ -1303,6 +1303,11 @@ int cam_sensor_core_power_up(struct cam_sensor_power_ctrl_t *ctrl,
 	for (index = 0; index < ctrl->power_setting_size; index++) {
 		CAM_DBG(CAM_SENSOR, "index: %d", index);
 		power_setting = &ctrl->power_setting[index];
+		if (!power_setting) {
+			CAM_ERR(CAM_SENSOR, "Invalid power up settings");
+			return -EINVAL;
+		}
+
 		CAM_DBG(CAM_SENSOR, "seq_type %d", power_setting->seq_type);
 
 		switch (power_setting->seq_type) {
@@ -1589,6 +1594,11 @@ static int cam_config_mclk_reg(struct cam_sensor_power_ctrl_t *ctrl,
 
 	pd = &ctrl->power_down_setting[index];
 
+	if (!pd) {
+		CAM_ERR(CAM_SENSOR, "Invalid power down setting");
+		return -EINVAL;
+	}
+
 	for (j = 0; j < num_vreg; j++) {
 		if (!strcmp(soc_info->rgltr_name[j], "cam_clk")) {
 
-- 
cgit v1.1

