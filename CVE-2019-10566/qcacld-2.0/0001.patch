From 48bbfadd209b0171de7c411851c44c1d7468f961 Mon Sep 17 00:00:00 2001
From: Min Liu <minliu@codeaurora.org>
Date: Tue, 2 Apr 2019 12:08:04 +0800
Subject: qcacld-2.0: Possible OOB access in wlan_hdd_cfg80211_start_bss()

Propagation from qcacld-3.0 to qcacld-2.0

Currently in function wlan_hdd_cfg80211_start_bss(), copying
supported rates and extended rates from information element pointer
without checking for array bounds which may cause OOB access.

To address this issue, add length checks before copying supported
rates and extended rates.

Change-Id: Ic6363e97bb3498a5dd23bc5e5f9b9f3ce093509d
CRs-Fixed: 2427503
---
 CORE/HDD/src/wlan_hdd_cfg80211.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/CORE/HDD/src/wlan_hdd_cfg80211.c b/CORE/HDD/src/wlan_hdd_cfg80211.c
index fa19cf1..1d1315d 100644
--- a/CORE/HDD/src/wlan_hdd_cfg80211.c
+++ b/CORE/HDD/src/wlan_hdd_cfg80211.c
@@ -18511,6 +18511,11 @@ static int wlan_hdd_cfg80211_start_bss(hdd_adapter_t *pHostapdAdapter,
                 pBeacon->head_len, WLAN_EID_SUPP_RATES);
         if (pIe != NULL) {
             pIe++;
+            if (pIe[0] > SIR_MAC_RATESET_EID_MAX) {
+                hddLog(LOGE, FL("Invalid supported rates %d"), pIe[0]);
+                ret = -EINVAL;
+                goto error;
+            }
             pConfig->supported_rates.numRates = pIe[0];
             pIe++;
             for (i = 0; i < pConfig->supported_rates.numRates; i++)
@@ -18524,6 +18529,11 @@ static int wlan_hdd_cfg80211_start_bss(hdd_adapter_t *pHostapdAdapter,
                 WLAN_EID_EXT_SUPP_RATES);
         if (pIe != NULL) {
             pIe++;
+            if (pIe[0] > SIR_MAC_RATESET_EID_MAX) {
+                hddLog(LOGE, FL("Invalid supported rates %d"), pIe[0]);
+                ret = -EINVAL;
+                goto error;
+            }
             pConfig->extended_rates.numRates = pIe[0];
             pIe++;
             for (i = 0; i < pConfig->extended_rates.numRates; i++)
-- 
cgit v1.1

