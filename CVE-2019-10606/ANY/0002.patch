From f4cfee6d9c53c1aadfc68bc1184a08c0397fba1c Mon Sep 17 00:00:00 2001
From: Pratham Pratap <prathampratap@codeaurora.org>
Date: Thu, 8 Mar 2018 12:49:31 +0530
Subject: usb: gadget: uvc: Update frame size as per frame type

Update frame size for MJPEG and H264 to prevent
out-of-bound access.

Change-Id: I92f110d07704cf39cf0e7c51fef90e4bdba413c0
Signed-off-by: Pratham Pratap <prathampratap@codeaurora.org>
---
 drivers/usb/gadget/function/uvc_configfs.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/usb/gadget/function/uvc_configfs.c b/drivers/usb/gadget/function/uvc_configfs.c
index 984b1d7..4e01ee5 100644
--- a/drivers/usb/gadget/function/uvc_configfs.c
+++ b/drivers/usb/gadget/function/uvc_configfs.c
@@ -2221,12 +2221,12 @@ static int __uvcg_cnt_strm(void *priv1, void *priv2, void *priv3, int n,
 			struct uvc_frame_mjpeg mf =
 				frm->frame.mf;
 			*size +=
-			UVC_DT_FRAME_UNCOMPRESSED_SIZE(mf.bFrameIntervalType);
+			UVC_DT_FRAME_MJPEG_SIZE(mf.bFrameIntervalType);
 		} else if (frm->fmt_type == UVCG_H264) {
 			struct uvc_frame_h264 hf =
 				frm->frame.hf;
 			*size +=
-			UVC_DT_FRAME_UNCOMPRESSED_SIZE(hf.bNumFrameIntervals);
+			UVC_DT_FRAME_H264_SIZE(hf.bNumFrameIntervals);
 		}
 	}
 	break;
-- 
cgit v1.1

