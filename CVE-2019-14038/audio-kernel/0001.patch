From 1587d00353aa5b1eb58a43b84195cb93df49cdb3 Mon Sep 17 00:00:00 2001
From: Sujin Panicker <spanic@codeaurora.org>
Date: Thu, 26 Sep 2019 18:08:51 +0530
Subject: dsp: adm: Fix to avoid memory overread in adm callback

For ADM_CMDRSP_GET_PP_PARAMS_V5 cmd response,
the check for data payload_size is incorrect.
Modify the check condition to make sure there
is enough data to copy, size is contained in
paylode.

Change-Id: I2f155ad8b302e89131ee85cfc72e4009dda617d3
Signed-off-by: Sujin Panicker <spanic@codeaurora.org>
---
 dsp/q6adm.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/dsp/q6adm.c b/dsp/q6adm.c
index 3a5e076..f8a3bce 100644
--- a/dsp/q6adm.c
+++ b/dsp/q6adm.c
@@ -1571,7 +1571,8 @@ static int32_t adm_callback(struct apr_client_data *data, void *priv)
 			idx = ADM_GET_PARAMETER_LENGTH * copp_idx;
 			if ((payload[0] == 0) && (data->payload_size >
 				(4 * sizeof(*payload))) &&
-				(data->payload_size - 4 >=
+				(data->payload_size -
+				(4 * sizeof(*payload)) >=
 				payload[3]) &&
 				(ARRAY_SIZE(adm_get_parameters) >
 				idx) &&
-- 
cgit v1.1

