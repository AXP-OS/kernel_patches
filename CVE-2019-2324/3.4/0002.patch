From 74db63329227e98370208cb5b4f37a0127bbf0e7 Mon Sep 17 00:00:00 2001
From: Xiaoyu Ye <benyxy@codeaurora.org>
Date: Tue, 15 Jan 2019 15:49:59 -0800
Subject: [PATCH] ASoC: msm: qdsp6v2: add range check for audio port index

Add range check to make sure the received audio port index
from ADSP is within the valid range.

Issue: SEC-2003
Change-Id: Ief647df1659f7f349a843f666d8f92f34a9a43be
Signed-off-by: Xiaoyu Ye <benyxy@codeaurora.org>
(cherry picked from commit afa24148a87180ad9eb8f93cd823f8db2b676815)
---
 sound/soc/msm/qdsp6v2/q6asm.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/sound/soc/msm/qdsp6v2/q6asm.c b/sound/soc/msm/qdsp6v2/q6asm.c
index 92de033fdfc..78296a703a6 100755
--- a/sound/soc/msm/qdsp6v2/q6asm.c
+++ b/sound/soc/msm/qdsp6v2/q6asm.c
@@ -1223,6 +1223,10 @@ static int32_t q6asm_srvc_callback(struct apr_client_data *data, void *priv)
 	}
 
 	dir = (data->token & 0x0F);
+	if (dir != IN && dir != OUT) {
+		pr_err("%s: Invalid audio port index: %d\n", __func__, dir);
+		return 0;
+	}
 	port = &ac->port[dir];
 
 	switch (data->opcode) {
