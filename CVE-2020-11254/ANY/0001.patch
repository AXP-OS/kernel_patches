From 9900d61a478ba8403b0e3bf22cf50b18973bc3c1 Mon Sep 17 00:00:00 2001
From: Edgar Flores <edgarf@codeaurora.org>
Date: Mon, 27 Jul 2020 19:14:17 -0700
Subject: msm: adsprpc: check for fastrpc session ctx initialization

Check if session ctx has been initialized before dereferencing.

Change-Id: Ic1db75ba779c102d95682e9fceca5720bb05ac76
Signed-off-by: Edgar Flores <edgarf@codeaurora.org>
---
 drivers/char/adsprpc.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index a748294..9dfa9e3 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -1386,6 +1386,11 @@ static int fastrpc_buf_alloc(struct fastrpc_file *fl, size_t size,
 	int err = 0, vmid;
 	struct fastrpc_buf *buf = NULL;
 
+	VERIFY(err, fl->sctx != NULL);
+	if (err) {
+		err = -EBADR;
+		goto bail;
+	}
 	VERIFY(err, size > 0 && fl->sctx->smmu.dev);
 	if (err) {
 		err = (fl->sctx->smmu.dev == NULL) ? -ENODEV : err;
-- 
cgit v1.1

