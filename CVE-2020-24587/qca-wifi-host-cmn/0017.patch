From b9eedc9d3bda343a6fcac7e9eb72edead64d00d5 Mon Sep 17 00:00:00 2001
From: Varsha Mishra <varsham@codeaurora.org>
Date: Wed, 17 Feb 2021 14:28:50 +0530
Subject: qcacmn: Flush fragment cache when peer reaches unauth state

Fragment cache needs to be flushed when peer is unauthorized.

Change-Id: Ia13ccbbcc90ae3f0b2f23d10468304633a86a965
---
 dp/wifi3.0/dp_main.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/dp/wifi3.0/dp_main.c b/dp/wifi3.0/dp_main.c
index 44605b4..a45b34e 100644
--- a/dp/wifi3.0/dp_main.c
+++ b/dp/wifi3.0/dp_main.c
@@ -7216,6 +7216,10 @@ dp_peer_authorize(struct cdp_soc_t *soc_hdl, uint8_t vdev_id,
 		status = QDF_STATUS_E_FAILURE;
 	} else {
 		peer->authorize = authorize ? 1 : 0;
+
+		if (!peer->authorize)
+			dp_peer_flush_frags(soc_hdl, vdev_id, peer_mac);
+
 		dp_peer_unref_delete(peer, DP_MOD_ID_CDP);
 	}
 
-- 
cgit v1.1

