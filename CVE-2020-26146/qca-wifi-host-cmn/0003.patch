From ef22bcb7a1b08de1a048dae1919795183943d6e0 Mon Sep 17 00:00:00 2001
From: Yeshwanth Sriram Guntuka <ysriramg@codeaurora.org>
Date: Thu, 28 Jan 2021 14:08:37 +0530
Subject: qcacmn: Modify check to ensure consecutive PN for frags

Modify check to ensure packet number is consecutive for
fragments and drop the fragments if the check fails.

Change-Id: I2ca0ef6211594ba35aae894e6a385d3d5778bff6
CRs-Fixed: 2874369
---
 dp/wifi3.0/dp_rx_defrag.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/dp/wifi3.0/dp_rx_defrag.c b/dp/wifi3.0/dp_rx_defrag.c
index 0d3d70d..84ddd3c 100644
--- a/dp/wifi3.0/dp_rx_defrag.c
+++ b/dp/wifi3.0/dp_rx_defrag.c
@@ -855,9 +855,9 @@ static int dp_rx_defrag_pn_check(qdf_nbuf_t msdu,
 		((uint64_t)rx_mpdu_info_details->pn_127_96 << 32);
 
 	if (cur_pn128[1] == prev_pn128[1])
-		out_of_order = (cur_pn128[0] <= prev_pn128[0]);
+		out_of_order = (cur_pn128[0] - prev_pn128[0] != 1);
 	else
-		out_of_order = (cur_pn128[1] < prev_pn128[1]);
+		out_of_order = (cur_pn128[1] - prev_pn128[1] != 1);
 
 	return out_of_order;
 }
-- 
cgit v1.1

