From ef44a87dc872a945d31eb9199895e460646ac946 Mon Sep 17 00:00:00 2001
From: Mohammed Nayeem Ur Rahman <mohara@codeaurora.org>
Date: Tue, 3 Dec 2019 16:42:40 +0530
Subject: msm: adsprpc: Fix adsprpc info leak

Fix adsprpc information leak in FASTRPC_IOCTL_GETPERF

Change-Id: Ic5f9127f08ece3e27b265dce03952518d17ae3fc
Signed-off-by: Mohammed Nayeem Ur Rahman <mohara@codeaurora.org>
---
 drivers/char/adsprpc.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index cbefe91..671d209 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -3595,8 +3595,10 @@ static long fastrpc_device_ioctl(struct file *file, unsigned int ioctl_num,
 			mutex_unlock(&fl->perf_mutex);
 
 			if (fperf) {
-				K_COPY_TO_USER(err, 0, (void *)p.perf.data,
-					fperf, sizeof(*fperf));
+				K_COPY_TO_USER(err, 0,
+					(void *)p.perf.data, fperf,
+					sizeof(*fperf) -
+					sizeof(struct hlist_node));
 			}
 		}
 		K_COPY_TO_USER(err, 0, param, &p.perf, sizeof(p.perf));
-- 
cgit v1.1

