From b7f8303e57bb15db102ae5637341b09ac5a2b86e Mon Sep 17 00:00:00 2001
From: hqu <hqu@codeaurora.org>
Date: Fri, 11 Dec 2020 11:18:38 +0800
Subject: qcacmn: Fix potential oob issue in wlan_parse_wapi_ie()

In function wlan_parse_wapi_ie(), len shows the remaining length
for ie content, it may cause oob issue when get uc_cipher_count
field from ie, need to add length check before get uc_cipher_count
field from ie.

Change-Id: Ie2d65284b2a172021d00f6385253368ec7603948
CRs-Fixed: 2832873
---
 umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h b/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h
index d6c98d3..b886d79 100644
--- a/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h
+++ b/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h
@@ -1757,9 +1757,12 @@ static inline void wlan_parse_wapi_ie(uint8_t *wapi_ie,
 		len -= WLAN_OUI_SIZE;
 	}
 
+	if (len < 2)
+		return;
 	wapi->uc_cipher_count = LE_READ_2(ie);
 	ie += 2;
 	len -= 2;
+
 	if ((wapi->uc_cipher_count > WLAN_MAX_CIPHER) ||
 	   len < (wapi->uc_cipher_count * WLAN_OUI_SIZE + 2))
 		return;
-- 
cgit v1.1

