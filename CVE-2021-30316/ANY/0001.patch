From 47667c9b7003f417a645dad1261058a18979fb37 Mon Sep 17 00:00:00 2001
From: Kasin Li <donglil@codeaurora.org>
Date: Wed, 14 Apr 2021 02:08:09 +0800
Subject: soc: qcom: hgsl: Fix OOB

Need check context index is valid or not before use it.

Change-Id: Ifd4f5dffb3a9317e13516e4863059b087d39fc66
Signed-off-by: Kasin Li <donglil@codeaurora.org>
---
 drivers/soc/qcom/hgsl/hgsl.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/soc/qcom/hgsl/hgsl.c b/drivers/soc/qcom/hgsl/hgsl.c
index 80f9b74..012b968 100644
--- a/drivers/soc/qcom/hgsl/hgsl.c
+++ b/drivers/soc/qcom/hgsl/hgsl.c
@@ -1,5 +1,5 @@
 /*
- * Copyright (c) 2019-2020, The Linux Foundation. All rights reserved.
+ * Copyright (c) 2019-2021, The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -686,7 +686,7 @@ static int hgsl_dbq_assign(struct file *filep, unsigned long arg)
 	if (copy_from_user(&dbq_idx, USRPTR(arg), sizeof(dbq_idx)))
 		return -EFAULT;
 
-	if (dbq_idx > MAX_DB_QUEUE)
+	if (dbq_idx >= MAX_DB_QUEUE)
 		return -EINVAL;
 
 	priv->dbq_idx = dbq_idx;
@@ -1101,6 +1101,9 @@ static int hgsl_wait_timestamp(struct file *filep, unsigned long arg)
 
 	timestamp = param.timestamp;
 
+	if (param.context_id >= HGSL_CONTEXT_NUM)
+		return -EINVAL;
+
 	read_lock(&hgsl->ctxt_lock);
 	ctxt = hgsl->contexts[param.context_id];
 	if (ctxt == NULL) {
-- 
cgit v1.1

