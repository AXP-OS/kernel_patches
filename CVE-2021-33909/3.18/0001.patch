diff --git a/fs/seq_file.c b/fs/seq_file.c
index 8f39335..f903947 100644
--- a/fs/seq_file.c
+++ b/fs/seq_file.c
@@ -12,6 +12,7 @@
 #include <linux/slab.h>
 #include <linux/cred.h>
 #include <linux/mm.h>
+#include <linux/pagemap.h>
 
 #include <asm/uaccess.h>
 #include <asm/page.h>
@@ -36,6 +37,9 @@
 {
 	void *buf;
 
+	if (unlikely(size > MAX_RW_COUNT))
+		return NULL;
+
 	buf = kmalloc(size, GFP_KERNEL | __GFP_NOWARN);
 	if (!buf && size > PAGE_SIZE)
 		buf = vmalloc(size);
