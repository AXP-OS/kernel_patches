From b65ae91bf232a5d0ba8c1dade2810b370735dd5a Mon Sep 17 00:00:00 2001
From: E V Ravi <evenka@codeaurora.org>
Date: Wed, 15 Sep 2021 17:32:37 +0530
Subject: msm: ais: jpeg: Ensure in/out map entries are within allowed range

Added checks to make sure in_map /out_map entries of packet
io configs are within expected maximum value.

Change-Id: I69d45096196944dd0f668a33edb5719ab7ca3f5c
Signed-off-by: E V Ravi <evenka@codeaurora.org>
---
 .../platform/msm/ais/cam_jpeg/jpeg_hw/cam_jpeg_hw_mgr.c      | 12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/drivers/media/platform/msm/ais/cam_jpeg/jpeg_hw/cam_jpeg_hw_mgr.c b/drivers/media/platform/msm/ais/cam_jpeg/jpeg_hw/cam_jpeg_hw_mgr.c
index 9ea8e3f..b4b09d4 100644
--- a/drivers/media/platform/msm/ais/cam_jpeg/jpeg_hw/cam_jpeg_hw_mgr.c
+++ b/drivers/media/platform/msm/ais/cam_jpeg/jpeg_hw/cam_jpeg_hw_mgr.c
@@ -1,4 +1,4 @@
-/* Copyright (c) 2017-2019, The Linux Foundation. All rights reserved.
+/* Copyright (c) 2017-2019,2021 The Linux Foundation. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -745,10 +745,12 @@ static int cam_jpeg_mgr_prepare_hw_update(void *hw_mgr_priv,
 	}
 
 	if ((packet->num_cmd_buf > 5) || !packet->num_patches ||
-		!packet->num_io_configs) {
-		CAM_ERR(CAM_JPEG, "wrong number of cmd/patch info: %u %u",
-			packet->num_cmd_buf,
-			packet->num_patches);
+		!packet->num_io_configs ||
+		(packet->num_io_configs > CAM_JPEG_IMAGE_MAX)) {
+		CAM_ERR(CAM_JPEG,
+			"wrong number of cmd/patch/io_configs info: %u %u %u",
+			packet->num_cmd_buf, packet->num_patches,
+			packet->num_io_configs);
 		return -EINVAL;
 	}
 
-- 
cgit v1.1

