From 3cad366931c849f5f5f5b0de89b51ed9100443fc Mon Sep 17 00:00:00 2001
From: Dundi Raviteja <dundi@codeaurora.org>
Date: Wed, 10 Mar 2021 11:56:36 +0530
Subject: [PATCH] wlan: Drop invalid EAPOL packets in SAP mode

Drop inalid EAPOL packets in SAP mode which are not
destined to self mac address.

Change-Id: I9754dddf580e60bd88ddc6e28355162499a8d125
CRs-Fixed: 2868054
---
 .../prima/CORE/HDD/src/wlan_hdd_softap_tx_rx.c       | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/drivers/staging/prima/CORE/HDD/src/wlan_hdd_softap_tx_rx.c b/drivers/staging/prima/CORE/HDD/src/wlan_hdd_softap_tx_rx.c
index 66b27cd259f..440957957d4 100644
--- a/drivers/staging/prima/CORE/HDD/src/wlan_hdd_softap_tx_rx.c
+++ b/drivers/staging/prima/CORE/HDD/src/wlan_hdd_softap_tx_rx.c
@@ -1647,9 +1647,19 @@ VOS_STATUS hdd_softap_rx_packet_cbk( v_VOID_t *vosContext,
          return VOS_STATUS_E_FAILURE;
       }
 
-      if (TRUE == hdd_IsEAPOLPacket(pVosPacket))
+      if (TRUE == hdd_IsEAPOLPacket(pVosPacket)) {
           wlan_hdd_log_eapol(skb, WIFI_EVENT_DRIVER_EAPOL_FRAME_RECEIVED);
 
+          if (vos_mem_compare2(skb->data,
+                               pAdapter->macAddressCurrent.bytes, 6) != 0) {
+              VOS_TRACE(VOS_MODULE_ID_HDD_SAP_DATA, VOS_TRACE_LEVEL_ERROR,
+                        "Packet is not destined to this address, dropping");
+              kfree_skb(skb);
+              pVosPacket = pNextVosPacket;
+              continue;
+          }
+      }
+
       pVosPacket->pSkb = NULL;
       //hdd_softap_dump_sk_buff(skb);
 
