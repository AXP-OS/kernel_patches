From 3840b68b9f132834b77ace3e69540bf25f51608b Mon Sep 17 00:00:00 2001
From: Jeff Johnson <jjohnson@codeaurora.org>
Date: Wed, 18 Oct 2017 15:08:21 -0700
Subject: [PATCH] prima: Propagate key sequence counter to SME

Currently the key sequence counter received from userspace is not
propagated to SME, so add logic to propagate it.

Change-Id: I5371700003744eb967c578c44e4d130628efcdc8
CRs-Fixed: 2129237
---
 .../staging/prima/CORE/HDD/src/wlan_hdd_cfg80211.c  | 13 ++++++++++---
 1 file changed, 10 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/prima/CORE/HDD/src/wlan_hdd_cfg80211.c b/drivers/staging/prima/CORE/HDD/src/wlan_hdd_cfg80211.c
index ae9d34ef7e26..233398e6c2c9 100755
--- a/drivers/staging/prima/CORE/HDD/src/wlan_hdd_cfg80211.c
+++ b/drivers/staging/prima/CORE/HDD/src/wlan_hdd_cfg80211.c
@@ -3244,15 +3244,22 @@ static int wlan_hdd_cfg80211_add_key( struct wiphy *wiphy,
         return -EINVAL;
     }
 
-    hddLog(VOS_TRACE_LEVEL_INFO,
-           "%s: called with key index = %d & key length %d",
-           __func__, key_index, params->key_len);
+	if (CSR_MAX_RSC_LEN < params->seq_len) {
+		hddLog(VOS_TRACE_LEVEL_ERROR, "%s: Invalid seq length %d", __func__,
+			params->seq_len);
+
+		return -EINVAL;
+	}
+
+	hddLog(VOS_TRACE_LEVEL_DEBUG, "%s: key index %d, key length %d, seq length %d",
+                     __func__, key_index, params->key_len, params->seq_len);
 
     /*extract key idx, key len and key*/
     vos_mem_zero(&setKey,sizeof(tCsrRoamSetKey));
     setKey.keyId = key_index;
     setKey.keyLength = params->key_len;
     vos_mem_copy(&setKey.Key[0],params->key, params->key_len);
+    vos_mem_copy(&setKey.keyRsc[0], params->seq, params->seq_len);
 
     switch (params->cipher)
     {
