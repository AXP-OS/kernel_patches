From c31254c8c5e838a17554a78417bb07366dc6edea Mon Sep 17 00:00:00 2001
From: Gururaj Pandurangi <panduran@codeaurora.org>
Date: Wed, 27 Oct 2021 12:02:58 -0700
Subject: [PATCH] wlan: Avoid OOB read in dot11f_unpack_assoc_response

Avoid OOB read in dot11f_unpack_assoc_response API. Modify
the check to nBuf-len > 1 to read another byte of pBufRemaining.
This ensures a read of at least 2 bytes since all IEs have
at least 2 bytes.

Issue: SEC-3386
Change-Id: If8f43739091b1baa8a86751fa60b9af2a90a751a
CRs-Fixed: 3064612
(cherry picked from commit edc957bca2d254d202765b7fd131261ad2b75a29)
---
 drivers/staging/prima/CORE/SYS/legacy/src/utils/src/dot11f.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/staging/prima/CORE/SYS/legacy/src/utils/src/dot11f.c b/drivers/staging/prima/CORE/SYS/legacy/src/utils/src/dot11f.c
index 78ea1ea8181..9788d247137 100644
--- a/drivers/staging/prima/CORE/SYS/legacy/src/utils/src/dot11f.c
+++ b/drivers/staging/prima/CORE/SYS/legacy/src/utils/src/dot11f.c
@@ -477,7 +477,7 @@ static tANI_U32 GetContainerIesLen(tpAniSirGlobal pCtx,
     len += *(pBufRemaining+1);
     pBufRemaining += len + 2;
     len += 2;
-    while ( len < nBuf )
+    while ( len + 1 < nBuf )
     {
         if( NULL == (pIe =  FindIEDefn(pCtx, pBufRemaining, nBuf - len, IEs)))
              break;
