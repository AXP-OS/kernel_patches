From 33a33b2eedc4349d73796f585986cdee7680310c Mon Sep 17 00:00:00 2001
From: Gururaj Pandurangi <panduran@codeaurora.org>
Date: Wed, 27 Oct 2021 12:16:54 -0700
Subject: qcacld-2.0: Avoid OOB read in dot11f_unpack_assoc_response

Avoid OOB read in dot11f_unpack_assoc_response API. Modify
the check to nBuf-len > 1 to read another byte of pBufRemaining.
This ensures a read of at least 2 bytes since all IEs have
at least 2 bytes.

Change-Id: I7a6fac87c48389db1f1981cf98991373e4014955
CRs-Fixed: 3064610
---
 CORE/SYS/legacy/src/utils/src/dot11f.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/CORE/SYS/legacy/src/utils/src/dot11f.c b/CORE/SYS/legacy/src/utils/src/dot11f.c
index ff98e49..1fbb476 100644
--- a/CORE/SYS/legacy/src/utils/src/dot11f.c
+++ b/CORE/SYS/legacy/src/utils/src/dot11f.c
@@ -494,7 +494,7 @@ static tANI_U32 GetContainerIesLen(tpAniSirGlobal pCtx,
     len += *(pBufRemaining+1);
     pBufRemaining += len + 2;
     len += 2;
-    while ( len < nBuf )
+    while ( len + 1 < nBuf )
     {
         if( NULL == (pIe =  FindIEDefn(pCtx, pBufRemaining, nBuf - len, IEs)))
              break;
-- 
cgit v1.1

