From 7084d65ae1a81ea81fba243420f7f79dea13d76f Mon Sep 17 00:00:00 2001
From: Sumukh Hallymysore Ravindra <quic_shallymy@quicinc.com>
Date: Wed, 15 Dec 2021 10:40:35 +0530
Subject: msm: synx: remove synx handle details from logging

Change removes logging synx object handle details
through debugfs entry to avoid potential UAF.
Details are used seldom, and only for debugging
purposes. Change will not affect the driver
functionalities.

Change-Id: Ice3546c63c6d48f286398984d0ad180afd969346
Signed-off-by: Sumukh Hallymysore Ravindra <quic_shallymy@quicinc.com>
---
 drivers/media/platform/msm/synx/synx_debugfs.c | 14 ++------------
 1 file changed, 2 insertions(+), 12 deletions(-)

diff --git a/drivers/media/platform/msm/synx/synx_debugfs.c b/drivers/media/platform/msm/synx/synx_debugfs.c
index 65a4763..c539ef0 100644
--- a/drivers/media/platform/msm/synx/synx_debugfs.c
+++ b/drivers/media/platform/msm/synx/synx_debugfs.c
@@ -1,6 +1,6 @@
 // SPDX-License-Identifier: GPL-2.0-only
 /*
- * Copyright (c) 2019, The Linux Foundation. All rights reserved.
+ * Copyright (c) 2019, 2022, The Linux Foundation. All rights reserved.
  */
 
 #include <linux/io.h>
@@ -19,7 +19,7 @@
 
 struct dentry *my_direc;
 const char delim[] = ",";
-int columns = NAME_COLUMN | ID_COLUMN |
+int columns = NAME_COLUMN |
 	BOUND_COLUMN | STATE_COLUMN | ERROR_CODES;
 
 void populate_bound_rows(
@@ -48,7 +48,6 @@ static ssize_t synx_table_read(struct file *file,
 	struct error_node *err_node, *err_node_tmp;
 	struct synx_table_row *row;
 	char *dbuf, *cur, *end;
-	struct synx_obj_node *obj_node;
 
 	int i = 0;
 	int state = SYNX_STATE_INVALID;
@@ -65,8 +64,6 @@ static ssize_t synx_table_read(struct file *file,
 		cur += scnprintf(cur, end - cur, "|   Bound   |");
 	if (columns & STATE_COLUMN)
 		cur += scnprintf(cur, end - cur, "|  Status  |");
-	if (columns & ID_COLUMN)
-		cur += scnprintf(cur, end - cur, "|    ID    |");
 	cur += scnprintf(cur, end - cur, "\n");
 	for (i = 0; i < SYNX_MAX_OBJS; i++) {
 		row = &dev->synx_table[i];
@@ -94,13 +91,6 @@ static ssize_t synx_table_read(struct file *file,
 				cur,
 				end);
 		}
-		if (columns & ID_COLUMN) {
-			list_for_each_entry(obj_node,
-				&row->synx_obj_list, list) {
-				cur += scnprintf(cur, end - cur,
-					"|0x%8x|", obj_node->synx_obj);
-				}
-		}
 		mutex_unlock(&dev->row_locks[row->index]);
 		cur += scnprintf(cur, end - cur, "\n");
 	}
-- 
cgit v1.1

