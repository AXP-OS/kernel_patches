From 470047b5c89944fe84737b1f529edd5b1c185782 Mon Sep 17 00:00:00 2001
From: Naman Jain <quic_namajain@quicinc.com>
Date: Tue, 25 Jan 2022 12:28:26 +0530
Subject: [PATCH] gunyah: gh_rm_iface: Avoid integer overflow for
 multiplication

Add a check to ensure that overflow does not happen in multiplication
operation.

Change-Id: I8b3be6acd92147543ab785c5762a1b2609e5a93d
Signed-off-by: Naman Jain <quic_namajain@quicinc.com>
---
 drivers/virt/gunyah/gh_rm_iface.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/virt/gunyah/gh_rm_iface.c b/drivers/virt/gunyah/gh_rm_iface.c
index 6abdead7ff15..031c93cd42ef 100644
--- a/drivers/virt/gunyah/gh_rm_iface.c
+++ b/drivers/virt/gunyah/gh_rm_iface.c
@@ -594,6 +594,8 @@ gh_rm_vm_get_hyp_res(gh_vmid_t vmid, u32 *n_entries)
 
 	/* The response payload should contain all the resource entries */
 	if (resp_payload_size < sizeof(*n_entries) ||
+		(sizeof(*resp_entries) &&
+		(resp_payload->n_resource_entries > U32_MAX / sizeof(*resp_entries))) ||
 		(sizeof(*n_entries) > (U32_MAX -
 		(resp_payload->n_resource_entries * sizeof(*resp_entries)))) ||
 		resp_payload_size != sizeof(*n_entries) +
-- 
GitLab

