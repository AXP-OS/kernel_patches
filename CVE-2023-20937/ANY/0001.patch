diff --git a/mm/mremap.c b/mm/mremap.c
index a46c810..6c87fc8 100644
--- a/mm/mremap.c
+++ b/mm/mremap.c
@@ -683,6 +683,7 @@
 		/* We always clear VM_LOCKED[ONFAULT] on the old vma */
 		vma->vm_flags &= VM_LOCKED_CLEAR_MASK;
 
+#ifndef CONFIG_SPECULATIVE_PAGE_FAULT
 		/*
 		 * anon_vma links of the old vma is no longer needed after its page
 		 * table has been moved.
@@ -690,6 +691,7 @@
 		if (new_vma != vma && vma->vm_start == old_addr &&
 			vma->vm_end == (old_addr + old_len))
 			unlink_anon_vmas(vma);
+#endif
 
 		/* Because we won't unmap we don't need to touch locked_vm */
 		return new_addr;
diff --git a/mm/rmap.c b/mm/rmap.c
index 440085a..df89881c 100644
--- a/mm/rmap.c
+++ b/mm/rmap.c
@@ -422,11 +422,13 @@
 	if (vma->anon_vma) {
 		vma->anon_vma->num_active_vmas--;
 
+#ifndef CONFIG_SPECULATIVE_PAGE_FAULT
 		/*
 		 * vma would still be needed after unlink, and anon_vma will be prepared
 		 * when handle fault.
 		 */
 		vma->anon_vma = NULL;
+#endif
 	}
 	unlock_anon_vma_root(root);
 
