From 9a0cd5fcd59f02ce0574daa7d4beaac29d8603ae Mon Sep 17 00:00:00 2001
From: Alan Chen <quic_alache@quicinc.com>
Date: Tue, 20 Dec 2022 11:30:47 -0800
Subject: [PATCH] cnss2: Add data length validation in
 cnss_wlfw_qdss_data_send_sync()

Add a data length validation check in fw response message in
qdss_data_send_sync().

Change-Id: I197b8d52c06e35f5fcf0f8fee94429fdcf500fcb
CRs-Fixed: 3359589
Signed-off-by: Alan Chen <quic_alache@quicinc.com>
---
 drivers/net/wireless/cnss2/qmi.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/net/wireless/cnss2/qmi.c b/drivers/net/wireless/cnss2/qmi.c
index 9b75720dfd794..fb80dd9919fff 100644
--- a/drivers/net/wireless/cnss2/qmi.c
+++ b/drivers/net/wireless/cnss2/qmi.c
@@ -959,7 +959,8 @@ int cnss_wlfw_qdss_data_send_sync(struct cnss_plat_data *plat_priv, char *file_n
 		     resp->total_size == total_size) &&
 		   (resp->seg_id_valid == 1 && resp->seg_id == req->seg_id) &&
 		   (resp->data_valid == 1 &&
-		    resp->data_len <= QMI_WLFW_MAX_DATA_SIZE_V01)) {
+		    resp->data_len <= QMI_WLFW_MAX_DATA_SIZE_V01) &&
+		   resp->data_len <= remaining) {
 			memcpy(p_qdss_trace_data_temp,
 			       resp->data, resp->data_len);
 		} else {
-- 
GitLab

