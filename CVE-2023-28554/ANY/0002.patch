From 931ef733b18836c5d8b6ca84545c3d888a7a5ed8 Mon Sep 17 00:00:00 2001
From: Sarannya S <quic_sarannya@quicinc.com>
Date: Wed, 28 Dec 2022 16:35:41 +0530
Subject: [PATCH] net: qrtr: Add bounds check in rx path

Validate the values read from shared memory in the receive path.
In the case where a VM is misbehaving, the qrtr transport should
return immediately and print a warning.

Change-Id: Ibb20ddbebcffbdff904fc7041fd452b09e0c96af
Signed-off-by: Sarannya S <quic_sarannya@quicinc.com>
---
 net/qrtr/fifo.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/net/qrtr/fifo.c b/net/qrtr/fifo.c
index 8947363528ec5..d5ccd5d808d53 100644
--- a/net/qrtr/fifo.c
+++ b/net/qrtr/fifo.c
@@ -90,6 +90,9 @@ static void fifo_rx_peak(struct fifo_pipe *pipe,
 	if (tail >= pipe->length)
 		tail -= pipe->length;
 
+	if (WARN_ON_ONCE(tail > pipe->length))
+		return;
+
 	len = min_t(size_t, count, pipe->length - tail);
 	if (len)
 		memcpy_fromio(data, pipe->fifo + tail, len);
-- 
GitLab

