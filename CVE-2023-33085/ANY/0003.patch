From 330e477773663acc022668ab82f9c50a3157559c Mon Sep 17 00:00:00 2001
From: Naveen S Nair <quic_naveensn@quicinc.com>
Date: Thu, 6 Jul 2023 15:04:11 +0530
Subject: [PATCH] soc: qcom: add buffer overflow check on AON rx_buffer

Add buffer overflow check while accessing data buffer
received from AON.

Change-Id: I89b1460a365cccfaa2ee418a8462e8c3d74ef7d8
Signed-off-by: Naveen S Nair <quic_naveensn@quicinc.com>
---
 drivers/soc/qcom/bg_rsb.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/soc/qcom/bg_rsb.c b/drivers/soc/qcom/bg_rsb.c
index 156caa3fd933b..1f5ed4ea912d4 100644
--- a/drivers/soc/qcom/bg_rsb.c
+++ b/drivers/soc/qcom/bg_rsb.c
@@ -1,4 +1,5 @@
 /* Copyright (c) 2017-2020, The Linux Foundation. All rights reserved.
+ * Copyright (c) 2022-2023, Qualcomm Innovation Center, Inc. All rights reserved.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 and
@@ -342,6 +343,10 @@ void bgrsb_rx_msg(void *data, int len)
 	struct bgrsb_priv *dev =
 		container_of(bgrsb_drv, struct bgrsb_priv, lhndl);
 
+	if (len > BGRSB_GLINK_INTENT_SIZE) {
+		pr_err("Invalid bgrsb glink intent size\n");
+		return;
+	}
 	dev->bg_resp_cmplt = true;
 	wake_up(&dev->link_state_wait);
 	memcpy(dev->rx_buf, data, len);
-- 
GitLab

