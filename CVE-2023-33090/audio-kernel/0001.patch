From 091eeea7e96cdc8c2803b5cbbe06227736503073 Mon Sep 17 00:00:00 2001
From: Sandhya Mutha Naga Venkata <quic_smuthana@quicinc.com>
Date: Tue, 16 May 2023 12:01:48 +0530
Subject: [PATCH] dsp: afe: Add check for num_channels

Check for valid num_channels before accessing.

Change-Id: I8f39d12e2f5f52fa145fbd3aed2b023afaa2b53b
Signed-off-by: Soumya Managoli <quic_c_smanag@quicinc.com>
---
 dsp/q6afe.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/dsp/q6afe.c b/dsp/q6afe.c
index 2227b2bb6..346b9bd8e 100644
--- a/dsp/q6afe.c
+++ b/dsp/q6afe.c
@@ -1124,6 +1124,9 @@ static int32_t afe_callback(struct apr_client_data *data, void *priv)
 				    sizeof(struct afe_port_mod_evt_rsp_hdr));
 				uint32_t *dc_presence_flag = num_channels + 1;
 
+				if (*num_channels < 1 || *num_channels > 4)
+					return -EINVAL;
+
 				for (i = 0; i < *num_channels; i++) {
 					if (dc_presence_flag[i] == 1)
 						dc_detected = true;
-- 
GitLab

