From 876b393aca242d60dc2512141efc9a827bbf124e Mon Sep 17 00:00:00 2001
From: Soumya Managoli <quic_c_smanag@quicinc.com>
Date: Mon, 31 Jul 2023 14:26:42 +0530
Subject: [PATCH] ASoC: msm-pcm-host-voice: Check validity of session idx

Added check for voice session index.

Change-Id: Ifff36add5d62f2fdc3395de1447075d297f2c2df
Signed-off-by: Soumya Managoli <quic_c_smanag@quicinc.com>
---
 techpack/audio/asoc/msm-pcm-host-voice-v2.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/techpack/audio/asoc/msm-pcm-host-voice-v2.c b/techpack/audio/asoc/msm-pcm-host-voice-v2.c
index 01cad940d385..49898e83a093 100644
--- a/techpack/audio/asoc/msm-pcm-host-voice-v2.c
+++ b/techpack/audio/asoc/msm-pcm-host-voice-v2.c
@@ -756,6 +756,13 @@ void hpcm_notify_evt_processing(uint8_t *data, char *session,
 		return;
 	}
 
+	if (prtd->mixer_conf.sess_indx < VOICE_INDEX ||
+		prtd->mixer_conf.sess_indx >= MAX_SESSION) {
+		pr_err("%s:: Invalid session idx %d\n",
+			__func__, prtd->mixer_conf.sess_indx);
+		return;
+	}
+
 	if (notify_evt->tap_point == VSS_IVPCM_TAP_POINT_TX_DEFAULT) {
 		tp = &prtd->session[prtd->mixer_conf.sess_indx].tx_tap_point;
 		tmd = &prtd->mixer_conf.tx;
