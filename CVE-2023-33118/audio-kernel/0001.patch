From bfd0e51c3c9b22c7f971d127dfd79158366c8f16 Mon Sep 17 00:00:00 2001
From: Soumya Managoli <quic_c_smanag@quicinc.com>
Date: Mon, 24 Jul 2023 16:14:09 +0530
Subject: [PATCH] dsp: q6lsm: Add check for payload buffer

Check get_param_payload buffer ptr before accessing.

Change-Id: I5470983188dffeec14965a5cdec30747b98735e7
Signed-off-by: Soumya Managoli <quic_c_smanag@quicinc.com>
---
 dsp/q6lsm.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/dsp/q6lsm.c b/dsp/q6lsm.c
index 14e585ea6..691a874d0 100644
--- a/dsp/q6lsm.c
+++ b/dsp/q6lsm.c
@@ -1,6 +1,7 @@
 // SPDX-License-Identifier: GPL-2.0-only
 /*
  * Copyright (c) 2013-2020, Linux Foundation. All rights reserved.
+ * Copyright (c) 2023 Qualcomm Innovation Center, Inc. All rights reserved.
  */
 #include <linux/fs.h>
 #include <linux/mutex.h>
@@ -235,6 +236,11 @@ static int q6lsm_callback(struct apr_client_data *data, void *priv)
 			goto done;
 		}
 
+		if (!client->get_param_payload) {
+			pr_err("%s: invalid get_param_payload buffer ptr\n", __func__);
+			ret = -EINVAL;
+			goto done;
+		}
 		memcpy((u8 *)client->get_param_payload,
 			(u8 *)payload + payload_min_size_expected, param_size);
 done:
-- 
GitLab

