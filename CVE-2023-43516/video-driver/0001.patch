From e21682f825e909a4389bee60bcd1768423aede97 Mon Sep 17 00:00:00 2001
From: Vikash Garodia <quic_vgarodia@quicinc.com>
Date: Thu, 13 Jul 2023 11:36:04 +0530
Subject: [PATCH] video: driver: Fix OOB access while handling fence property

Fence property payload is copied into a fixed length instance
array. When the payload exceeds the size of array, there is a
possible case of out of bound access.
The fix ensures that the memcpy is avoided when the payload
exceeds the size of memory allocated to accomodate the payload.

Change-Id: I38b8c0f0ee92011f6209adfb83c7b9c0fd869e4a
Signed-off-by: Vikash Garodia <quic_vgarodia@quicinc.com>
---
 driver/vidc/src/venus_hfi_response.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/driver/vidc/src/venus_hfi_response.c b/driver/vidc/src/venus_hfi_response.c
index 36b33451..cba16b65 100644
--- a/driver/vidc/src/venus_hfi_response.c
+++ b/driver/vidc/src/venus_hfi_response.c
@@ -1698,6 +1698,7 @@ static int handle_property_fence_array(struct msm_vidc_inst *inst,
 			"%s: fence list payload size %d exceeds expected max size %d\n",
 			__func__, payload_size, sizeof(inst->hfi_frame_info.fence_id));
 		msm_vidc_change_state(inst, MSM_VIDC_ERROR, __func__);
+		return -EINVAL;
 	}
 
 	for (i = 0; i < fence_count; i++) {
-- 
GitLab

