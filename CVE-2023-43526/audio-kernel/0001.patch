From 277c7b9cddc12ef7bb87910290160e9f16ee18ce Mon Sep 17 00:00:00 2001
From: Soumya Managoli <quic_c_smanag@quicinc.com>
Date: Wed, 21 Jun 2023 17:17:03 +0530
Subject: [PATCH] ASoC: msm-lsm-client: Integer overflow check

Add integer overflow check for lsm_params_get_info size.

Change-Id: I1130b5294f5de65eb8c595030c4db221337b1c8a
Signed-off-by: Soumya Managoli <quic_c_smanag@quicinc.com>
---
 asoc/msm-lsm-client.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/asoc/msm-lsm-client.c b/asoc/msm-lsm-client.c
index 29d9f2169..cbb437cff 100644
--- a/asoc/msm-lsm-client.c
+++ b/asoc/msm-lsm-client.c
@@ -2650,6 +2650,15 @@ static int msm_lsm_ioctl(struct snd_soc_component *component, struct snd_pcm_sub
 			err = -EFAULT;
 			goto done;
 		}
+
+		if (temp_p_info.param_size > 0 &&
+			((INT_MAX - sizeof(temp_p_info)) <
+				temp_p_info.param_size)) {
+			pr_err("%s: Integer overflow\n", __func__);
+			err = -EINVAL;
+			goto done;
+		}
+
 		size = sizeof(temp_p_info) +  temp_p_info.param_size;
 		p_info = kzalloc(size, GFP_KERNEL);
 
-- 
GitLab

