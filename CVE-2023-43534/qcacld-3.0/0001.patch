From 1b5a78038619597643bb0e7ab05d6bbcab522e5e Mon Sep 17 00:00:00 2001
From: Amruta Kulkarni <quic_amrukulk@quicinc.com>
Date: Wed, 2 Aug 2023 17:40:49 -0700
Subject: [PATCH] qcacld-3.0: Add check for valid t2lm ie direction

When validating t2lm ie, check if the direction is valid.

Change-Id: I5eaa5e67653960647ebb65a57690692dd95ad6f3
CRs-Fixed: 3575491
---
 components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c b/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c
index 96a6d545936..b3493f8c8d0 100644
--- a/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c
+++ b/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c
@@ -87,8 +87,10 @@ bool t2lm_is_valid_t2lm_link_map(struct wlan_objmgr_vdev *vdev,
 		    WLAN_T2LM_INVALID_DIRECTION)
 			continue;
 
-		if (t2lm->t2lm_info[dir].default_link_mapping) {
+		if (t2lm->t2lm_info[dir].default_link_mapping &&
+		    t2lm->t2lm_info[dir].direction == WLAN_T2LM_BIDI_DIRECTION) {
 			is_valid_link_mask = true;
+			*valid_dir = dir;
 			continue;
 		}
 
-- 
GitLab

