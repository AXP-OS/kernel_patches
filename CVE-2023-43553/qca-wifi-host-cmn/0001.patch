From 846c1e28b4019b94ee4fd2b401bb053c30beb7c5 Mon Sep 17 00:00:00 2001
From: Vinod Kumar Myadam <quic_vmyadam@quicinc.com>
Date: Thu, 10 Aug 2023 17:48:43 +0530
Subject: [PATCH] qcacmn: Validate num_links before accessing data

In util_parse_rv_info_from_linkinfo, accessing the array of data
without validating the index of the array will cause OOB issue.

Add check with the maximum size of the array before accessing the
data.

Change-Id: Ie8b33c83fa1cd18cfbfcb6c7a82b79ddd86e8808
CRs-Fixed: 3580821
(cherry picked from commit 151331ba76e502b9769c8fb9aac4432e6a8b32db)
---
 umac/mlo_mgr/src/utils_mlo.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/umac/mlo_mgr/src/utils_mlo.c b/umac/mlo_mgr/src/utils_mlo.c
index 22bcd2c0d2a..b7705d5350a 100644
--- a/umac/mlo_mgr/src/utils_mlo.c
+++ b/umac/mlo_mgr/src/utils_mlo.c
@@ -4490,6 +4490,12 @@ util_parse_rv_info_from_linkinfo(uint8_t *linkinfo,
 								      &ap_removal_timer);
 			if (QDF_IS_STATUS_ERROR(ret))
 				return ret;
+			if (reconfig_info->num_links >=
+						WLAN_UMAC_MLO_MAX_VDEVS) {
+				mlo_err("num_link %d invalid",
+					reconfig_info->num_links);
+				return QDF_STATUS_E_INVAL;
+			}
 			link_info =
 			&reconfig_info->link_info[reconfig_info->num_links];
 			link_info->link_id = linkid;
-- 
GitLab

