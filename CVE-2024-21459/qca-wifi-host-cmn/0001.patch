From 857e30ee2cb61ea3e8086ff119a5d690a66972a2 Mon Sep 17 00:00:00 2001
From: Qian Zhang <quic_zhangq@quicinc.com>
Date: Fri, 22 Sep 2023 15:29:59 +0800
Subject: [PATCH] qcacmn: Fix OOB issue

Changes to fix OOB issue seen util_scan_parse_beacon_frame.

Change-Id: I5b0f4d31edbb98a93f1beb9e8750475b9aa38cbd
CRs-Fixed: 3582496
---
 umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h | 3 +++
 umac/scan/dispatcher/src/wlan_scan_utils_api.c      | 3 +++
 2 files changed, 6 insertions(+)

diff --git a/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h b/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h
index 88b5129764e..fdd5687ed49 100644
--- a/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h
+++ b/umac/cmn_services/cmn_defs/inc/wlan_cmn_ieee80211.h
@@ -147,6 +147,9 @@
 /* Max channel switch time IE length */
 #define WLAN_MAX_CHAN_SWITCH_TIME_IE_LEN         4
 
+#define WLAN_MIN_HECAP_IE_LEN                    22
+#define WLAN_MAX_HECAP_IE_LEN                    55
+
 /* HT capability flags */
 #define WLAN_HTCAP_C_ADVCODING             0x0001
 #define WLAN_HTCAP_C_CHWIDTH40             0x0002
diff --git a/umac/scan/dispatcher/src/wlan_scan_utils_api.c b/umac/scan/dispatcher/src/wlan_scan_utils_api.c
index 242f64eb806..b31046360c1 100644
--- a/umac/scan/dispatcher/src/wlan_scan_utils_api.c
+++ b/umac/scan/dispatcher/src/wlan_scan_utils_api.c
@@ -753,6 +753,9 @@ util_scan_parse_extn_ie(struct scan_cache_entry *scan_params,
 		scan_params->ie_list.srp   = (uint8_t *)ie;
 		break;
 	case WLAN_EXTN_ELEMID_HECAP:
+		if ((extn_ie->ie_len < WLAN_MIN_HECAP_IE_LEN) ||
+		    (extn_ie->ie_len > WLAN_MAX_HECAP_IE_LEN))
+			return QDF_STATUS_E_INVAL;
 		scan_params->ie_list.hecap = (uint8_t *)ie;
 		break;
 	case WLAN_EXTN_ELEMID_HEOP:
-- 
GitLab

