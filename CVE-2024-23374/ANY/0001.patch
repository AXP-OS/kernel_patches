From a2cc7ad8d48baa4b256c265fd8a5527f8ae21d8b Mon Sep 17 00:00:00 2001
From: Jishnu Prakash <quic_jprakash@quicinc.com>
Date: Tue, 21 Nov 2023 11:42:06 +0530
Subject: [PATCH] input: misc: add check for number of input patterns in
 pattern_s_dbgfs_write

Add a check for number of input patterns detected in string read from
userspace in pattern_s_dbgfs_write() API, to avoid out-of-bounds write
in a local array.

Change-Id: Ic35561ae34f95c67fbd54ae4db4a7174342f45f4
Signed-off-by: Jishnu Prakash <quic_jprakash@quicinc.com>
---
 drivers/input/misc/qcom-hv-haptics.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/input/misc/qcom-hv-haptics.c b/drivers/input/misc/qcom-hv-haptics.c
index e3d71c78fb5ca..fed7dd9acbdb3 100644
--- a/drivers/input/misc/qcom-hv-haptics.c
+++ b/drivers/input/misc/qcom-hv-haptics.c
@@ -3489,6 +3489,11 @@ static ssize_t pattern_s_dbgfs_write(struct file *fp,
 			goto exit;
 		}
 
+		if (i >= ARRAY_SIZE(tmp)) {
+			pr_err("too many patterns in input string\n");
+			rc = -EINVAL;
+			goto exit;
+		}
 		tmp[i++] = val;
 	}
 
-- 
GitLab

