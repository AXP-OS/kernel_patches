From 3d5955a210ed0dd49e0a6434eda758b1230a1e4d Mon Sep 17 00:00:00 2001
From: Raza Kamal <quic_razkam@quicinc.com>
Date: Mon, 4 Dec 2023 15:33:09 +0530
Subject: [PATCH] Audio legacy: Integer overflow in msm_lsm_ioctl_compat during
 audio playback usecase. size = sizeof(p_info_32) + p_info_32.param_size; This
 overflow issue may result heap overflow during copying the data:
 memcpy(param_info_rsp, &p_info_32, sizeof(p_info_32));

The validation check is added so that heap overflow can be avoided.

Change-Id: I11dcbe7ebb33e349dfd9f347f3ef25bc781075fc
Signed-off-by: Raza Kamal <quic_razkam@quicinc.com>
---
 asoc/msm-lsm-client.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/asoc/msm-lsm-client.c b/asoc/msm-lsm-client.c
index f4a8dbdce..409edb3b1 100644
--- a/asoc/msm-lsm-client.c
+++ b/asoc/msm-lsm-client.c
@@ -2167,8 +2167,13 @@ static int msm_lsm_ioctl_compat(struct snd_pcm_substream *substream,
 			prtd->lsm_client->get_param_payload = NULL;
 			goto done;
 		}
+		if (__builtin_uadd_overflow(sizeof(p_info_32), p_info_32.param_size, &size)) {
+			pr_err("%s: param size exceeds limit of %u bytes.\n",
+				__func__, UINT_MAX);
+			err = -EINVAL;
+			goto done;
+		}
 
-		size = sizeof(p_info_32) + p_info_32.param_size;
 		param_info_rsp = kzalloc(size, GFP_KERNEL);
 
 		if (!param_info_rsp) {
-- 
GitLab

