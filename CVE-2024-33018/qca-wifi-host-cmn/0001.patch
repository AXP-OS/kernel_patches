From 5f7ea1bc78cff3ced84300689eef24d209bf39b3 Mon Sep 17 00:00:00 2001
From: Shashikala Prabhu <quic_pshashik@quicinc.com>
Date: Sat, 17 Feb 2024 09:38:43 +0530
Subject: [PATCH] qcacmn: Fix out-of-bound read in T2LM IE parse API

In wlan_mlo_parse_t2lm_ie(), the code is present to check if the frame
length is less than the parsed IE length plus size of ie_header structure
(2 bytes). If the above condition is false then the subsequent code will
access the data of parsed IE length plus size of extn_ie_header structure
(3 bytes).

To fix the out-of-bound read, check if the frame length is less than
parsed IE length plus size of extn_ie_header structure.
Also, added the code to return success if frame length is same as parsed
IE length.

Change-Id: I07c32379ecd18d253a82876127c33b4d95196dd2
CRs-Fixed: 3704796
---
 umac/mlo_mgr/src/wlan_mlo_t2lm.c | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/umac/mlo_mgr/src/wlan_mlo_t2lm.c b/umac/mlo_mgr/src/wlan_mlo_t2lm.c
index 2b8ddcb7edb..f5b4d264b11 100644
--- a/umac/mlo_mgr/src/wlan_mlo_t2lm.c
+++ b/umac/mlo_mgr/src/wlan_mlo_t2lm.c
@@ -224,8 +224,16 @@ QDF_STATUS wlan_mlo_parse_t2lm_ie(
 			return QDF_STATUS_E_NULL_VALUE;
 		}
 
-		if (frame_len < (ie_len_parsed + sizeof(struct ie_header))) {
-			t2lm_err("Frame length is lesser than parsed T2LM IE header length");
+		if (frame_len == ie_len_parsed) {
+			t2lm_debug("Received T2LM IEs are parsed successfully");
+			return QDF_STATUS_SUCCESS;
+		}
+
+		if (frame_len < (ie_len_parsed +
+				 sizeof(struct extn_ie_header))) {
+			t2lm_err("Frame length %d is lesser than parsed T2LM IE header length %zu",
+				 frame_len,
+				 ie_len_parsed + sizeof(struct extn_ie_header));
 			return QDF_STATUS_E_PROTO;
 		}
 
-- 
GitLab

