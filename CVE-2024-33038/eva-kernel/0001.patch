From 849b1c0f92c365c22a83492bb91590075be18c2b Mon Sep 17 00:00:00 2001
From: Gopireddy Arunteja Reddy <quic_garuntej@quicinc.com>
Date: Tue, 23 Apr 2024 20:01:52 +0530
Subject: [PATCH] msm: eva: Added instance validation check

Checking the validation of inst after converting from dsp2cpu low
and high values.

Change-Id: Iee1d792c00035ff79e1b002d181924620aed901f
Signed-off-by: Gopireddy Arunteja Reddy <quic_garuntej@quicinc.com>
---
 msm/eva/msm_cvp_dsp.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/msm/eva/msm_cvp_dsp.c b/msm/eva/msm_cvp_dsp.c
index ebb6941..f079219 100644
--- a/msm/eva/msm_cvp_dsp.c
+++ b/msm/eva/msm_cvp_dsp.c
@@ -1,6 +1,7 @@
 // SPDX-License-Identifier: GPL-2.0-only
 /*
  * Copyright (c) 2018-2021, The Linux Foundation. All rights reserved.
+ * Copyright (c) 2023-2024 Qualcomm Innovation Center, Inc. All rights reserved.
  */
 #include <linux/module.h>
 #include <linux/rpmsg.h>
@@ -1492,7 +1493,8 @@ static void __dsp_cvp_power_req(struct cvp_dsp_cmd_msg *cmd)
 			dsp2cpu_cmd->session_cpu_high,
 			dsp2cpu_cmd->session_cpu_low);
 
-	if (!inst) {
+	if (!inst || !is_cvp_inst_valid(inst)) {
+		dprintk(CVP_ERR, "%s incorrect session ID %llx\n", __func__, inst);
 		cmd->ret = -1;
 		goto dsp_fail_power_req;
 	}
-- 
GitLab

