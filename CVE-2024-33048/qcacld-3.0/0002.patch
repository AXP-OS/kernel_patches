From de1cdc259a42a09ea38e6f16f7b27b166c0f28c6 Mon Sep 17 00:00:00 2001
From: Deeksha Gupta <quic_deegupta@quicinc.com>
Date: Mon, 12 Feb 2024 14:35:15 +0530
Subject: [PATCH] qcacld-3.0: Fix out-of-bound in
 wlan_mlo_parse_bcn_prbresp_t2lm_ie

Currently, In the MLO t2lm API, wlan_mlo_parse_bcn_prbresp_t2lm_ie
is missing frame boundary checks which may lead to out-of-bound
reads if the lengths are not checked by the caller.

Fix is, while parsing t2lm ie pass the frame length and add
check for frame boundary.

CRs-Fixed: 3707241
Change-Id: Ic83638eff2250a704df8dfa8bd233238fcc7a25b
---
 components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c b/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c
index 1e2d4277895..b5d427bcd50 100644
--- a/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c
+++ b/components/umac/mlme/mlo_mgr/src/wlan_t2lm_api.c
@@ -1,5 +1,5 @@
 /*
- * Copyright (c) 2022-2023 Qualcomm Innovation Center, Inc. All rights reserved.
+ * Copyright (c) 2022-2024 Qualcomm Innovation Center, Inc. All rights reserved.
  *
  * Permission to use, copy, modify, and/or distribute this software for any
  * purpose with or without fee is hereby granted, provided that the above
@@ -458,7 +458,8 @@ wlan_t2lm_validate_candidate(struct cnx_mgr *cm_ctx,
 	if ((wlan_vdev_mlme_get_opmode(vdev) == QDF_STA_MODE) &&
 	    scan_entry->ie_list.t2lm[0]) {
 		status = wlan_mlo_parse_bcn_prbresp_t2lm_ie(&t2lm_ctx,
-						scan_entry->ie_list.t2lm[0]);
+					util_scan_entry_t2lm(scan_entry),
+					util_scan_entry_t2lm_len(scan_entry));
 		if (QDF_IS_STATUS_ERROR(status))
 			goto end;
 
-- 
GitLab

