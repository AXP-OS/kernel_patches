From 1983ad49ec26ec6959181ce345146acd043ae1b5 Mon Sep 17 00:00:00 2001
From: Krupali Dhanvijay <quic_kdhanvij@quicinc.com>
Date: Tue, 9 Jan 2024 15:17:38 +0530
Subject: [PATCH] qcacmn: Add cinfo length check to fix heap buffer overflow
 issue

Add proper cinfo length check to fix heap buffer overflow issue
while generating link specific (re)association request/response,
as well as in the API for getting per-STA partner link information.

Change-Id: Ida561790bb745d6861a3a07b9db09b5b24443a6a
CRs-Fixed: 3699767
(cherry picked from commit 540316b23d37370a2b447ee1d7a0d2eb47294a86)
---
 umac/mlo_mgr/src/utils_mlo.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/umac/mlo_mgr/src/utils_mlo.c b/umac/mlo_mgr/src/utils_mlo.c
index 84d9a4bf202..a69c0a7dae9 100644
--- a/umac/mlo_mgr/src/utils_mlo.c
+++ b/umac/mlo_mgr/src/utils_mlo.c
@@ -125,6 +125,16 @@ util_parse_multi_link_ctrl(uint8_t *mlieseqpayload,
 	}
 
 	cinfo_len = *(mlieseqpayload + parsed_payload_len);
+
+	if (cinfo_len >
+			(mlieseqpayloadlen - parsed_payload_len)) {
+		mlo_err_rl("ML seq common info len %u larger than ML seq payload len %zu after parsed payload len %zu.",
+			   cinfo_len,
+			   mlieseqpayloadlen,
+			   parsed_payload_len);
+		return QDF_STATUS_E_PROTO;
+	}
+
 	parsed_payload_len += WLAN_ML_BV_CINFO_LENGTH_SIZE;
 
 	if (mlieseqpayloadlen <
-- 
GitLab

