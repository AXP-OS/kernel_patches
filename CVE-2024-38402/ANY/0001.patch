From 28204d125055f0dec3e9625382cb92810f5528d0 Mon Sep 17 00:00:00 2001
From: ANANDU KRISHNAN E <quic_anane@quicinc.com>
Date: Wed, 7 Aug 2024 14:43:25 +0530
Subject: [PATCH] msm: adsprpc: Avoid taking reference for group_info

Currently, the get_current_groups API accesses group info, which
increases the usage refcount. If the IOCTL using the
get_current_groups API is called many times, the usage counter
overflows. To avoid this, access group info without taking a
reference. A reference is not required as group info is not
released during the IOCTL call.

Change-Id: I596fefd315a942864c05ad13778effdbce32acba
Signed-off-by: ANANDU KRISHNAN E <quic_anane@quicinc.com>
---
 drivers/char/adsprpc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/char/adsprpc.c b/drivers/char/adsprpc.c
index 64a28032f7fd0..a9fd81b17a401 100644
--- a/drivers/char/adsprpc.c
+++ b/drivers/char/adsprpc.c
@@ -6301,7 +6301,7 @@ static int fastrpc_device_open(struct inode *inode, struct file *filp)
 
 static int fastrpc_get_process_gids(struct gid_list *gidlist)
 {
-	struct group_info *group_info = get_current_groups();
+	struct group_info *group_info = current_cred()->group_info;
 	int i = 0, err = 0, num_gids = group_info->ngroups + 1;
 	unsigned int *gids = NULL;
 
-- 
GitLab

